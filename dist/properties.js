/*! For license information please see properties.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(l=64)),i.push(n[u],n[h],n[l],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],r=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==r||null==o||null==a)throw Error();const c=s<<2|r>>4;if(i.push(c),64!==o){const t=r<<4&240|o>>2;if(i.push(t),64!==a){const t=o<<6&192|a;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},i=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")};class s{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function r(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function o(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(r())}function a(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function c(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function u(){const t=r();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function h(){return"object"==typeof indexedDB}function l(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class d extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(p,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new d(i,o,n)}}const p=/\{\$([^}]+)}/g;function g(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(m(n)&&m(r)){if(!g(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function m(t){return null!==t&&"object"==typeof t}function y(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function v(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,i]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(i)}})),e}function w(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class I{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let i;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");i=function(t,e){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===i.next&&(i.next=E),void 0===i.error&&(i.error=E),void 0===i.complete&&(i.complete=E);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(t){}})),this.observers.push(i),s}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function E(){}function b(t,e=1e3,n=2){const i=e*Math.pow(n,t),s=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+s)}function T(t){return t&&t._delegate?t._delegate:t}class _{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const S="[DEFAULT]";class C{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new s;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:S})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===S?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:S:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class k{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new C(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const A=[];var N,D;(D=N||(N={}))[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";const R={debug:N.DEBUG,verbose:N.VERBOSE,info:N.INFO,warn:N.WARN,error:N.ERROR,silent:N.SILENT},O=N.INFO,L={[N.DEBUG]:"log",[N.VERBOSE]:"log",[N.INFO]:"info",[N.WARN]:"warn",[N.ERROR]:"error"},P=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=L[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class M{constructor(t){this.name=t,this._logLevel=O,this._logHandler=P,this._userLogHandler=null,A.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in N))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?R[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,N.DEBUG,...t),this._logHandler(this,N.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,N.VERBOSE,...t),this._logHandler(this,N.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,N.INFO,...t),this._logHandler(this,N.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,N.WARN,...t),this._logHandler(this,N.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,N.ERROR,...t),this._logHandler(this,N.ERROR,...t)}}let x,F;const U=new WeakMap,V=new WeakMap,j=new WeakMap,B=new WeakMap,q=new WeakMap;let $={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return V.get(t);if("objectStoreNames"===e)return t.objectStoreNames||j.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return K(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function z(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(H(this),t),K(U.get(this))}:function(...t){return K(e.apply(H(this),t))}:function(t,...n){const i=e.call(H(this),t,...n);return j.set(i,t.sort?t.sort():[t]),K(i)}:(t instanceof IDBTransaction&&function(t){if(V.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));V.set(t,e)}(t),n=t,(x||(x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,$):t);var e,n}function K(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(K(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&U.set(e,t)})).catch((()=>{})),q.set(e,t),e}(t);if(B.has(t))return B.get(t);const e=z(t);return e!==t&&(B.set(t,e),q.set(e,t)),e}const H=t=>q.get(t);function G(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=K(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(K(o.result),t.oldVersion,t.newVersion,K(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}const W=["get","getKey","getAll","getAllKeys","count"],Q=["put","add","delete","clear"],X=new Map;function J(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(X.get(e))return X.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=Q.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!W.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return X.set(e,r),r}var Y;Y=$,$={...Y,get:(t,e,n)=>J(t,e)||Y.get(t,e,n),has:(t,e)=>!!J(t,e)||Y.has(t,e)};class Z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const tt="@firebase/app",et="0.7.27",nt=new M("@firebase/app"),it={[tt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},st=new Map,rt=new Map;function ot(t,e){try{t.container.addComponent(e)}catch(n){nt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function at(t){const e=t.name;if(rt.has(e))return nt.debug(`There were multiple attempts to register component ${e}.`),!1;rt.set(e,t);for(const e of st.values())ot(e,t);return!0}function ct(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const ut=new f("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class ht{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new _("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ut.create("app-deleted",{appName:this._name})}}const lt="9.8.4";function dt(t="[DEFAULT]"){const e=st.get(t);if(!e)throw ut.create("no-app",{appName:t});return e}function ft(t,e,n){var i;let s=null!==(i=it[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void nt.warn(t.join(" "))}at(new _(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const pt="firebase-heartbeat-store";let gt=null;function mt(){return gt||(gt=G("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(pt)}}).catch((t=>{throw ut.create("storage-open",{originalErrorMessage:t.message})}))),gt}async function yt(t,e){var n;try{const n=(await mt()).transaction(pt,"readwrite"),i=n.objectStore(pt);return await i.put(e,vt(t)),n.done}catch(t){throw ut.create("storage-set",{originalErrorMessage:null===(n=t)||void 0===n?void 0:n.message})}}function vt(t){return`${t.name}!${t.options.appId}`}class wt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Et(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=It();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=It(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),bt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),bt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function It(){return(new Date).toISOString().substring(0,10)}class Et{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!h()&&l().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){var e;try{return(await mt()).transaction(pt).objectStore(pt).get(vt(t))}catch(t){throw ut.create("storage-get",{originalErrorMessage:null===(e=t)||void 0===e?void 0:e.message})}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function bt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}function Tt(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n}at(new _("platform-logger",(t=>new Z(t)),"PRIVATE")),at(new _("heartbeat",(t=>new wt(t)),"PRIVATE")),ft(tt,et,""),ft(tt,et,"esm2017"),ft("fire-js",""),Object.create,Object.create;const _t=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},St=new f("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ct=new M("@firebase/auth");function kt(t,...e){Ct.logLevel<=N.ERROR&&Ct.error(`Auth (9.8.4): ${t}`,...e)}function At(t,...e){throw Dt(t,...e)}function Nt(t,...e){return Dt(t,...e)}function Dt(t,...e){if("string"!=typeof t){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return St.create(t,...e)}function Rt(t,e,...n){if(!t)throw Dt(e,...n)}function Ot(t){const e="INTERNAL ASSERTION FAILED: "+t;throw kt(e),new Error(e)}function Lt(t,e){t||Ot(e)}const Pt=new Map;function Mt(t){Lt(t instanceof Function,"Expected a class definition");let e=Pt.get(t);return e?(Lt(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Pt.set(t,e),e)}function xt(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function Ft(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class Ut{constructor(t,e){this.shortDelay=t,this.longDelay=e,Lt(e>t,"Short delay should be less than long delay!"),this.isMobile=o()||c()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Ft()||"https:"===Ft()||a()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Vt(t,e){Lt(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class jt{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Ot("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Ot("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Ot("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Bt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},qt=new Ut(3e4,6e4);function $t(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function zt(t,e,n,i,s={}){return Kt(t,s,(async()=>{let s={},r={};i&&("GET"===e?r=i:s={body:JSON.stringify(i)});const o=y(Object.assign({key:t.config.apiKey},r)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),jt.fetch()(Gt(t,t.config.apiHost,n,o),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},s))}))}async function Kt(t,e,n){t._canInitEmulator=!1;const i=Object.assign(Object.assign({},Bt),e);try{const e=new Wt(t),s=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Qt(t,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const e=s.ok?r.errorMessage:r.error.message,[n,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Qt(t,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Qt(t,"email-already-in-use",r);if("USER_DISABLED"===n)throw Qt(t,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(t,e,n){const i=Object.assign(Object.assign({},_t()),{[e]:n});return new f("auth","Firebase",i).create(e,{appName:t.name})}(t,a,o);At(t,a)}}catch(e){if(e instanceof d)throw e;At(t,"network-request-failed")}}async function Ht(t,e,n,i,s={}){const r=await zt(t,e,n,i,s);return"mfaPendingCredential"in r&&At(t,"multi-factor-auth-required",{_serverResponse:r}),r}function Gt(t,e,n,i){const s=`${e}${n}?${i}`;return t.config.emulator?Vt(t.config,s):`${t.config.apiScheme}://${s}`}class Wt{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(Nt(this.auth,"network-request-failed"))),qt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Qt(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=Nt(t,e,i);return s.customData._tokenResponse=n,s}function Xt(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function Jt(t){return 1e3*Number(t)}function Yt(t){var e;const[i,s,r]=t.split(".");if(void 0===i||void 0===s||void 0===r)return kt("JWT malformed, contained fewer than 3 sections"),null;try{const t=function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(s);return t?JSON.parse(t):(kt("Failed to decode base64 JWT payload"),null)}catch(t){return kt("Caught error parsing JWT payload as JSON",null===(e=t)||void 0===e?void 0:e.toString()),null}}async function Zt(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof d&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class te{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){var t;try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===(t=e)||void 0===t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class ee{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xt(this.lastLoginAt),this.creationTime=Xt(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ne(t){var e;const n=t.auth,i=await t.getIdToken(),s=await Zt(t,async function(t,e){return zt(t,"POST","/v1/accounts:lookup",e)}(n,{idToken:i}));Rt(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];t._notifyReloadListener(r);const o=(null===(e=r.providerUserInfo)||void 0===e?void 0:e.length)?r.providerUserInfo.map((t=>{var{providerId:e}=t,n=Tt(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=t.providerData,u=o,[...c.filter((t=>!u.some((e=>e.providerId===t.providerId)))),...u]);var c,u;const h=t.isAnonymous,l=!(t.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new ee(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,f)}class ie{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Rt(t.idToken,"internal-error"),Rt(void 0!==t.idToken,"internal-error"),Rt(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=Yt(t);return Rt(e,"internal-error"),Rt(void 0!==e.exp,"internal-error"),Rt(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return Rt(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(t,e){const n=await Kt(t,{},(async()=>{const n=y({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,r=Gt(t,i,"/v1/token",`key=${s}`),o=await t._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",jt.fetch()(r,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:i,expirationTime:s}=e,r=new ie;return n&&(Rt("string"==typeof n,"internal-error",{appName:t}),r.refreshToken=n),i&&(Rt("string"==typeof i,"internal-error",{appName:t}),r.accessToken=i),s&&(Rt("number"==typeof s,"internal-error",{appName:t}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new ie,this.toJSON())}_performRefresh(){return Ot("not implemented")}}function se(t,e){Rt("string"==typeof t||void 0===t,"internal-error",{appName:e})}class re{constructor(t){var{uid:e,auth:n,stsTokenManager:i}=t,s=Tt(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new te(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ee(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await Zt(this,this.stsTokenManager.getToken(this.auth,t));return Rt(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=T(t),i=await n.getIdToken(e),s=Yt(i);Rt(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:Xt(Jt(s.auth_time)),issuedAtTime:Xt(Jt(s.iat)),expirationTime:Xt(Jt(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=T(t);await ne(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(Rt(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){return new re(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(t){Rt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await ne(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await Zt(this,async function(t,e){return zt(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,i,s,r,o,a,c,u;const h=null!==(n=e.displayName)&&void 0!==n?n:void 0,l=null!==(i=e.email)&&void 0!==i?i:void 0,d=null!==(s=e.phoneNumber)&&void 0!==s?s:void 0,f=null!==(r=e.photoURL)&&void 0!==r?r:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,g=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=e.createdAt)&&void 0!==c?c:void 0,y=null!==(u=e.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:E,stsTokenManager:b}=e;Rt(v&&b,t,"internal-error");const T=ie.fromJSON(this.name,b);Rt("string"==typeof v,t,"internal-error"),se(h,t.name),se(l,t.name),Rt("boolean"==typeof w,t,"internal-error"),Rt("boolean"==typeof I,t,"internal-error"),se(d,t.name),se(f,t.name),se(p,t.name),se(g,t.name),se(m,t.name),se(y,t.name);const _=new re({uid:v,auth:t,email:l,emailVerified:w,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(_.providerData=E.map((t=>Object.assign({},t)))),g&&(_._redirectEventId=g),_}static async _fromIdTokenResponse(t,e,n=!1){const i=new ie;i.updateFromServerResponse(e);const s=new re({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await ne(s),s}}class oe{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}oe.type="NONE";const ae=oe;function ce(t,e,n){return`firebase:${t}:${e}:${n}`}class ue{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=ce(this.userKey,i.apiKey,s),this.fullPersistenceKey=ce("persistence",i.apiKey,s),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?re._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new ue(Mt(ae),t,n);const i=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let s=i[0]||Mt(ae);const r=ce(n,t.config.apiKey,t.name);let o=null;for(const n of e)try{const e=await n._get(r);if(e){const i=re._fromJSON(t,e);n!==s&&(o=i),s=n;break}}catch(t){}const a=i.filter((t=>t._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==s)try{await t._remove(r)}catch(t){}}))),new ue(s,t,n)):new ue(s,t,n)}}function he(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(pe(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(le(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(me(e))return"Blackberry";if(ye(e))return"Webos";if(de(e))return"Safari";if((e.includes("chrome/")||fe(e))&&!e.includes("edge/"))return"Chrome";if(ge(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function le(t=r()){return/firefox\//i.test(t)}function de(t=r()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fe(t=r()){return/crios\//i.test(t)}function pe(t=r()){return/iemobile/i.test(t)}function ge(t=r()){return/android/i.test(t)}function me(t=r()){return/blackberry/i.test(t)}function ye(t=r()){return/webos/i.test(t)}function ve(t=r()){return/iphone|ipad|ipod/i.test(t)}function we(t=r()){return ve(t)||ge(t)||ye(t)||me(t)||/windows phone/i.test(t)||pe(t)}function Ie(t,e=[]){let n;switch(t){case"Browser":n=he(r());break;case"Worker":n=`${he(r())}-${t}`;break;default:n=t}return`${n}/JsCore/9.8.4/${e.length?e.join(","):"FirebaseCore-web"}`}class Ee{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise(((n,i)=>{try{n(t(e))}catch(t){i(t)}}));n.onAbort=e,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){var e;if(this.auth.currentUser===t)return;const n=[];try{for(const e of this.queue)await e(t),e.onAbort&&n.push(e.onAbort)}catch(t){n.reverse();for(const t of n)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===(e=t)||void 0===e?void 0:e.message})}}}class be{constructor(t,e,n){this.app=t,this.heartbeatServiceProvider=e,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _e(this),this.idTokenSubscription=new _e(this),this.beforeStateQueue=new Ee(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=St,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=Mt(e)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await ue.create(this,t),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUser(t){var e;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(t);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(t){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Rt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){var e;try{await ne(t)}catch(t){if("auth/network-request-failed"!==(null===(e=t)||void 0===e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?T(t):null;return e&&Rt(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Rt(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Mt(t))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new f("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Mt(t)||this._popupRedirectResolver;Rt(e,this,"argument-error"),this.redirectPersistenceManager=await ue.create(this,[Mt(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,i){if(this._deleted)return()=>{};const s="function"==typeof e?e:e.next.bind(e),r=this._isInitialized?Promise.resolve():this._initializationPromise;return Rt(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof e?t.addObserver(e,n,i):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&(this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh()),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Rt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Ie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return n&&(e["X-Firebase-Client"]=n),e}}function Te(t){return T(t)}class _e{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t,e){const n=new I(t,void 0);return n.subscribe.bind(n)}((t=>this.observer=t))}get next(){return Rt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class Se{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Ot("not implemented")}_getIdTokenResponse(t){return Ot("not implemented")}_linkToIdToken(t,e){return Ot("not implemented")}_getReauthenticationResolver(t){return Ot("not implemented")}}class Ce extends Se{constructor(t,e,n,i=null){super("password",n),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new Ce(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new Ce(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(t,e){return Ht(t,"POST","/v1/accounts:signInWithPassword",$t(t,e))}(t,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Ht(t,"POST","/v1/accounts:signInWithEmailLink",$t(t,e))}(t,{email:this._email,oobCode:this._password});default:At(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return async function(t,e){return zt(t,"POST","/v1/accounts:update",e)}(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Ht(t,"POST","/v1/accounts:signInWithEmailLink",$t(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:At(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function ke(t,e){return Ht(t,"POST","/v1/accounts:signInWithIdp",$t(t,e))}class Ae extends Se{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Ae(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):At("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:i}=e,s=Tt(e,["providerId","signInMethod"]);if(!n||!i)return null;const r=new Ae(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(t){return ke(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,ke(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,ke(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=y(e)}return t}}const Ne={USER_NOT_FOUND:"user-not-found"};class De extends Se{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new De({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new De({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return Ht(t,"POST","/v1/accounts:signInWithPhoneNumber",$t(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await Ht(t,"POST","/v1/accounts:signInWithPhoneNumber",$t(t,e));if(n.temporaryProof)throw Qt(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return Ht(t,"POST","/v1/accounts:signInWithPhoneNumber",$t(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),Ne)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:i}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:i}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:s}=t;return n||e||i||s?new De({verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class Re{constructor(t){var e,n,i,s,r,o;const a=v(w(t)),c=null!==(e=a.apiKey)&&void 0!==e?e:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Rt(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(t){const e=function(t){const e=v(w(t)).link,n=e?v(w(e)).deep_link_id:null,i=v(w(t)).deep_link_id;return(i?v(w(i)).link:null)||i||n||e||t}(t);try{return new Re(e)}catch(t){return null}}}class Oe{constructor(){this.providerId=Oe.PROVIDER_ID}static credential(t,e){return Ce._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Re.parseLink(e);return Rt(n,"argument-error"),Ce._fromEmailAndCode(t,n.code,n.tenantId)}}Oe.PROVIDER_ID="password",Oe.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Oe.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Le{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class Pe extends Le{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class Me extends Pe{constructor(){super("facebook.com")}static credential(t){return Ae._fromParams({providerId:Me.PROVIDER_ID,signInMethod:Me.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Me.credentialFromTaggedObject(t)}static credentialFromError(t){return Me.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Me.credential(t.oauthAccessToken)}catch(t){return null}}}Me.FACEBOOK_SIGN_IN_METHOD="facebook.com",Me.PROVIDER_ID="facebook.com";class xe extends Pe{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Ae._fromParams({providerId:xe.PROVIDER_ID,signInMethod:xe.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return xe.credentialFromTaggedObject(t)}static credentialFromError(t){return xe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return xe.credential(e,n)}catch(t){return null}}}xe.GOOGLE_SIGN_IN_METHOD="google.com",xe.PROVIDER_ID="google.com";class Fe extends Pe{constructor(){super("github.com")}static credential(t){return Ae._fromParams({providerId:Fe.PROVIDER_ID,signInMethod:Fe.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Fe.credentialFromTaggedObject(t)}static credentialFromError(t){return Fe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Fe.credential(t.oauthAccessToken)}catch(t){return null}}}Fe.GITHUB_SIGN_IN_METHOD="github.com",Fe.PROVIDER_ID="github.com";class Ue extends Pe{constructor(){super("twitter.com")}static credential(t,e){return Ae._fromParams({providerId:Ue.PROVIDER_ID,signInMethod:Ue.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Ue.credentialFromTaggedObject(t)}static credentialFromError(t){return Ue.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return Ue.credential(e,n)}catch(t){return null}}}Ue.TWITTER_SIGN_IN_METHOD="twitter.com",Ue.PROVIDER_ID="twitter.com";class Ve{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,i=!1){const s=await re._fromIdTokenResponse(t,n,i),r=je(n);return new Ve({user:s,providerId:r,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const i=je(n);return new Ve({user:t,providerId:i,_tokenResponse:n,operationType:e})}}function je(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Be extends d{constructor(t,e,n,i){var s;super(e.code,e.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Be.prototype),this.customData={appName:t.name,tenantId:null!==(s=t.tenantId)&&void 0!==s?s:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,i){return new Be(t,e,n,i)}}function qe(t,e,n,i){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Be._fromErrorAndOperation(t,n,e,i);throw n}))}new WeakMap;const $e="__sak";class ze{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem($e,"1"),this.storage.removeItem($e),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ke extends ze{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=r();return de(t)||ve(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=we(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),i=this.localCache[e];n!==i&&t(e,i,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(t.newValue!==i)null!==t.newValue?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!e)return}const i=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},s=this.storage.getItem(n);u()&&10===document.documentMode&&s!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,10):i()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Ke.type="LOCAL";const He=Ke;class Ge extends ze{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Ge.type="SESSION";const We=Ge;class Qe{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new Qe(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:i,data:s}=e.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async t=>t(e.origin,s))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Xe(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}Qe.receivers=[];class Je{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const c=Xe("",20);i.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(u),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(e.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function Ye(){return window}function Ze(){return void 0!==Ye().WorkerGlobalScope&&"function"==typeof Ye().importScripts}const tn="firebaseLocalStorageDb",en="firebaseLocalStorage",nn="fbase_key";class sn{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function rn(t,e){return t.transaction([en],e?"readwrite":"readonly").objectStore(en)}function on(){const t=indexedDB.open(tn,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(en,{keyPath:nn})}catch(t){n(t)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(en)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(tn);return new sn(t).toPromise()}(),e(await on()))}))}))}async function an(t,e,n){const i=rn(t,!0).put({[nn]:e,value:n});return new sn(i).toPromise()}function cn(t,e){const n=rn(t,!0).delete(e);return new sn(n).toPromise()}class un{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await on()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ze()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qe._getInstance(Ze()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new Je(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(this.sender&&this.activeServiceWorker&&function(){var t;return(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await on();return await an(t,$e,"1"),await cn(t,$e),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>an(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=rn(t,!1).get(e),i=await new sn(n).toPromise();return void 0===i?null:i.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>cn(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=rn(t,!1).getAll();return new sn(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;for(const{fbase_key:i,value:s}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),e.push(i));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}un.type="LOCAL";const hn=un;function ln(t){return`__${t}${Math.floor(1e6*Math.random())}`}ln("rcb"),new Ut(3e4,6e4);class dn{constructor(t){this.providerId=dn.PROVIDER_ID,this.auth=Te(t)}verifyPhoneNumber(t,e){return async function(t,e,n){var i;const s=await n.verify();try{let r;if(Rt("string"==typeof s,t,"argument-error"),Rt("recaptcha"===n.type,t,"argument-error"),r="string"==typeof e?{phoneNumber:e}:e,"session"in r){const e=r.session;if("phoneNumber"in r){Rt("enroll"===e.type,t,"internal-error");const n=await function(t,e){return zt(t,"POST","/v2/accounts/mfaEnrollment:start",$t(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{Rt("signin"===e.type,t,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;Rt(n,t,"missing-multi-factor-info");const o=await function(t,e){return zt(t,"POST","/v2/accounts/mfaSignIn:start",$t(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return zt(t,"POST","/v1/accounts:sendVerificationCode",$t(t,e))}(t,{phoneNumber:r.phoneNumber,recaptchaToken:s});return e}}finally{n._reset()}}(this.auth,t,T(e))}static credential(t,e){return De._fromVerification(t,e)}static credentialFromResult(t){const e=t;return dn.credentialFromTaggedObject(e)}static credentialFromError(t){return dn.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?De._fromTokenResponse(e,n):null}}dn.PROVIDER_ID="phone",dn.PHONE_SIGN_IN_METHOD="phone";class fn extends Se{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return ke(t,this._buildIdpRequest())}_linkToIdToken(t,e){return ke(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return ke(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function pn(t){return async function(t,e,n=!1){const i="signIn",s=await qe(t,i,e),r=await Ve._fromIdTokenResponse(t,i,s);return n||await t._updateCurrentUser(r.user),r}(t.auth,new fn(t),t.bypassAuthState)}function gn(t){const{auth:e,user:n}=t;return Rt(n,e,"internal-error"),async function(t,e,n=!1){var i;const{auth:s}=t,r="reauthenticate";try{const i=await Zt(t,qe(s,r,e,t),n);Rt(i.idToken,s,"internal-error");const o=Yt(i.idToken);Rt(o,s,"internal-error");const{sub:a}=o;return Rt(t.uid===a,s,"user-mismatch"),Ve._forOperation(t,r,i)}catch(t){throw"auth/user-not-found"===(null===(i=t)||void 0===i?void 0:i.code)&&At(s,"user-mismatch"),t}}(n,new fn(t),t.bypassAuthState)}async function mn(t){const{auth:e,user:n}=t;return Rt(n,e,"internal-error"),async function(t,e,n=!1){const i=await Zt(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ve._forOperation(t,"link",i)}(n,new fn(t),t.bypassAuthState)}class yn{constructor(t,e,n,i,s=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=t;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return pn;case"linkViaPopup":case"linkViaRedirect":return mn;case"reauthViaPopup":case"reauthViaRedirect":return gn;default:At(this.auth,"internal-error")}}resolve(t){Lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const vn=new Ut(2e3,1e4);class wn extends yn{constructor(t,e,n,i,s){super(t,e,i,s),this.provider=n,this.authWindow=null,this.pollId=null,wn.currentPopupAction&&wn.currentPopupAction.cancel(),wn.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Rt(t,this.auth,"internal-error"),t}async onExecution(){Lt(1===this.filter.length,"Popup operations only handle one event");const t=Xe();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(Nt(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Nt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,wn.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Nt(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(t,vn.get())};t()}}wn.currentPopupAction=null;const In=new Map;class En extends yn{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=In.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return ce("pendingRedirect",t.config.apiKey,t.name)}(e),i=function(t){return Mt(t._redirectPersistence)}(t);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}In.set(this.auth._key(),t)}return this.bypassAuthState||In.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function bn(t,e){In.set(t._key(),e)}async function Tn(t,e,n=!1){const i=Te(t),s=function(t,e){return e?Mt(e):(Rt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(i,e),r=new En(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}class _n{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Cn(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Cn(t)){const i=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(Nt(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Sn(t))}saveEventToCache(t){this.cachedEventUids.add(Sn(t)),this.lastProcessedEventTime=Date.now()}}function Sn(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function Cn({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const kn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,An=/^https?/;function Nn(t){const e=xt(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const s=new URL(t);return""===s.hostname&&""===i?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!An.test(n))return!1;if(kn.test(t))return i===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const Dn=new Ut(3e4,6e4);function Rn(){const t=Ye().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let On=null;function Ln(t){return On=On||function(t){return new Promise(((e,n)=>{var i,s,r,o;function a(){Rn(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Rn(),n(Nt(t,"network-request-failed"))},timeout:Dn.get()})}if(null===(s=null===(i=Ye().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)e(gapi.iframes.getContext());else{if(!(null===(r=Ye().gapi)||void 0===r?void 0:r.load)){const e=ln("iframefcb");return Ye()[e]=()=>{gapi.load?a():n(Nt(t,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${e}`,new Promise(((t,e)=>{const n=document.createElement("script");n.setAttribute("src",o),n.onload=t,n.onerror=t=>{const n=Nt("internal-error");n.customData=t,e(n)},n.type="text/javascript",n.charset="UTF-8",function(){var t,e;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(n)}))).catch((t=>n(t)))}a()}})).catch((t=>{throw On=null,t}))}(t),On}const Pn=new Ut(5e3,15e3),Mn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},xn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Fn(t){const e=t.config;Rt(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Vt(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:t.name,v:lt},s=xn.get(t.config.apiHost);s&&(i.eid=s);const r=t._getFrameworks();return r.length&&(i.fw=r.join(",")),`${n}?${y(i).slice(1)}`}const Un={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Vn{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function jn(t,e,n,i,s,r){Rt(t.config.authDomain,t,"auth-domain-config-required"),Rt(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:lt,eventId:s};if(e instanceof Le){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(r||{}))o[t]=e}if(e instanceof Pe){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(o.scopes=t.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];return`${function({config:t}){return t.emulator?Vt(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${y(a).slice(1)}`}const Bn="webStorageSupport",qn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=We,this._completeRedirectFn=Tn,this._overrideRedirectResult=bn}async _openPopup(t,e,n,i){var s;return Lt(null===(s=this.eventManagers[t._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(t,e,n,i=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Un),{width:i.toString(),height:s.toString(),top:o,left:a}),h=r().toLowerCase();n&&(c=fe(h)?"_blank":n),le(h)&&(e=e||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=r()){var e;return ve(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(h)&&"_self"!==c)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(e||"",c),new Vn(null);const d=window.open(e||"",c,l);Rt(d,t,"popup-blocked");try{d.focus()}catch(t){}return new Vn(d)}(t,jn(t,e,n,xt(),i),Xe())}async _openRedirect(t,e,n,i){var s;return await this._originValidation(t),s=jn(t,e,n,xt(),i),Ye().location.href=s,new Promise((()=>{}))}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(Lt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch((()=>{delete this.eventManagers[e]})),n}async initAndGetManager(t){const e=await async function(t){const e=await Ln(t),n=Ye().gapi;return Rt(n,t,"internal-error"),e.open({where:document.body,url:Fn(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Mn,dontclear:!0},(e=>new Promise((async(n,i)=>{await e.restyle({setHideOnLeave:!1});const s=Nt(t,"network-request-failed"),r=Ye().setTimeout((()=>{i(s)}),Pn.get());function o(){Ye().clearTimeout(r),n(e)}e.ping(o).then(o,(()=>{i(s)}))}))))}(t),n=new _n(t);return e.register("authEvent",(e=>(Rt(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Bn,{type:Bn},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i.webStorageSupport;void 0!==s&&e(!!s),At(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return zt(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(Nn(t))return}catch(t){}At(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return we()||de()||ve()}};var $n,zn="@firebase/auth",Kn="0.20.4";class Hn{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{var n;t((null===(n=e)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Rt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}$n="Browser",at(new _("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),{apiKey:s,authDomain:r}=n.options;return((t,n)=>{Rt(s&&!s.includes(":"),"invalid-api-key",{appName:t.name}),Rt(!(null==r?void 0:r.includes(":")),"argument-error",{appName:t.name});const i={apiKey:s,authDomain:r,clientPlatform:$n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ie($n)},o=new be(t,n,i);return function(t,e){const n=(null==e?void 0:e.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Mt);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,null==e?void 0:e.popupRedirectResolver)}(o,e),o})(n,i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),at(new _("auth-internal",(t=>{return e=Te(t.getProvider("auth").getImmediate()),new Hn(e);var e}),"PRIVATE").setInstantiationMode("EXPLICIT")),ft(zn,Kn,void 0),ft(zn,Kn,"esm2017"),ft("firebase","9.8.4","app");const Gn="@firebase/installations",Wn="0.5.11",Qn="w:0.5.11",Xn=new f("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Jn(t){return t instanceof d&&t.code.includes("request-failed")}function Yn({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function Zn(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function ti(t,e){const n=(await e.json()).error;return Xn.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ei({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function ni(t){const e=await t();return e.status>=500&&e.status<600?t():e}function ii(t){return new Promise((e=>{setTimeout(e,t)}))}const si=/^[cdef][\w-]{21}$/;function ri(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}(t);return si.test(e)?e:""}catch(t){return""}}function oi(t){return`${t.appName}!${t.appId}`}const ai=new Map;function ci(t,e){const n=oi(t);ui(n,e),function(t,e){const n=(!hi&&"BroadcastChannel"in self&&(hi=new BroadcastChannel("[Firebase] FID Change"),hi.onmessage=t=>{ui(t.data.key,t.data.fid)}),hi);n&&n.postMessage({key:t,fid:e}),0===ai.size&&hi&&(hi.close(),hi=null)}(n,e)}function ui(t,e){const n=ai.get(t);if(n)for(const t of n)t(e)}let hi=null;const li="firebase-installations-store";let di=null;function fi(){return di||(di=G("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(li)}})),di}async function pi(t,e){const n=oi(t),i=(await fi()).transaction(li,"readwrite"),s=i.objectStore(li),r=await s.get(n);return await s.put(e,n),await i.done,r&&r.fid===e.fid||ci(t,e.fid),e}async function gi(t){const e=oi(t),n=(await fi()).transaction(li,"readwrite");await n.objectStore(li).delete(e),await n.done}async function mi(t,e){const n=oi(t),i=(await fi()).transaction(li,"readwrite"),s=i.objectStore(li),r=await s.get(n),o=e(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||ci(t,o.fid),o}async function yi(t){let e;const n=await mi(t.appConfig,(n=>{const i=function(t){return Ii(t||{fid:ri(),registrationStatus:0})}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Xn.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=Yn(t),s=ei(t),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={fid:n,authVersion:"FIS_v2",appId:t.appId,sdkVersion:Qn},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await ni((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Zn(t.authToken)}}throw await ti("Create Installation",c)}(t,e);return pi(t.appConfig,n)}catch(n){throw Jn(n)&&409===n.customData.serverCode?await gi(t.appConfig):await pi(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:vi(t)}:{installationEntry:e}}(t,i);return e=s.registrationPromise,s.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function vi(t){let e=await wi(t.appConfig);for(;1===e.registrationStatus;)await ii(100),e=await wi(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await yi(t);return n||e}return e}function wi(t){return mi(t,(t=>{if(!t)throw Xn.create("installation-not-found");return Ii(t)}))}function Ii(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Ei({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${Yn(t)}/${e}/authTokens:generate`}(t,n),s=function(t,{refreshToken:e}){const n=ei(t);return n.append("Authorization",function(t){return`FIS_v2 ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={installation:{sdkVersion:Qn,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await ni((()=>fetch(i,a)));if(c.ok)return Zn(await c.json());throw await ti("Generate Auth Token",c)}async function bi(t,e=!1){let n;const i=await mi(t.appConfig,(i=>{if(!_i(i))throw Xn.create("not-registered");const s=i.authToken;if(!e&&(2===(r=s).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(r)))return i;var r;if(1===s.requestStatus)return n=async function(t,e){let n=await Ti(t.appConfig);for(;1===n.authToken.requestStatus;)await ii(100),n=await Ti(t.appConfig);const i=n.authToken;return 0===i.requestStatus?bi(t,e):i}(t,e),i;{if(!navigator.onLine)throw Xn.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await Ei(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await pi(t.appConfig,i),n}catch(n){if(!Jn(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await pi(t.appConfig,n)}else await gi(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function Ti(t){return mi(t,(t=>{if(!_i(t))throw Xn.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function _i(t){return void 0!==t&&2===t.registrationStatus}function Si(t){return Xn.create("missing-app-config-values",{valueName:t})}const Ci="installations";at(new _(Ci,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Si("App Configuration");if(!t.name)throw Si("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Si(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:ct(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),at(new _("installations-internal",(t=>{const e=ct(t.getProvider("app").getImmediate(),Ci).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await yi(e);return i?i.catch(console.error):bi(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await yi(t);e&&await e}(n),(await bi(n,e)).token}(e,t)}}),"PRIVATE")),ft(Gn,Wn),ft(Gn,Wn,"esm2017");const ki="analytics",Ai="https://www.googletagmanager.com/gtag/js",Ni=new M("@firebase/analytics");function Di(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Ri=new f("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Oi=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Li(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Pi(t,e=Oi,n){const{appId:i,apiKey:s,measurementId:r}=t.options;if(!i)throw Ri.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Ri.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new xi;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),Mi({appId:i,apiKey:s,measurementId:r},o,a,e)}async function Mi(t,{throttleEndTimeMillis:e,backoffCount:n},i,s=Oi){var r,o;const{appId:a,measurementId:c}=t;try{await function(t,e){return new Promise(((n,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(n,s);t.addEventListener((()=>{clearTimeout(r),i(Ri.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(c)return Ni.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null===(r=t)||void 0===r?void 0:r.message}]`),{appId:a,measurementId:c};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,s={method:"GET",headers:Li(i)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Ri.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return s.deleteThrottleMetadata(a),e}catch(e){const r=e;if(!function(t){if(!(t instanceof d&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(r)){if(s.deleteThrottleMetadata(a),c)return Ni.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==r?void 0:r.message}]`),{appId:a,measurementId:c};throw e}const u=503===Number(null===(o=null==r?void 0:r.customData)||void 0===o?void 0:o.httpStatus)?b(n,s.intervalMillis,30):b(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return s.setThrottleMetadata(a,h),Ni.debug(`Calling attemptFetch again in ${u} millis`),Mi(t,h,i,s)}}class xi{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}class Fi{constructor(t){this.app=t}_delete(){return delete Ui[this.app.options.appId],Promise.resolve()}}let Ui={},Vi=[];const ji={};let Bi,qi,$i="dataLayer",zi=!1;function Ki(t,e,n){!function(){const t=[];if(a()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Ri.create("invalid-analytics-context",{errorInfo:e});Ni.warn(n.message)}}();const i=t.options.appId;if(!i)throw Ri.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Ri.create("no-api-key");Ni.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ui[i])throw Ri.create("already-exists",{id:i});if(!zi){!function(t){let e=[];Array.isArray(window.dataLayer)?e=window.dataLayer:window.dataLayer=e}();const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,s){let r=function(...t){window.dataLayer.push(arguments)};return window.gtag&&"function"==typeof window.gtag&&(r=window.gtag),window.gtag=function(t,e,n,i){return async function(s,r,o){try{"event"===s?await async function(t,e,n,i,s){try{let r=[];if(s&&s.send_to){let t=s.send_to;Array.isArray(t)||(t=[t]);const i=await Di(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),s=t&&e[t.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(e)),await Promise.all(r),t("event",i,s||{})}catch(t){Ni.error(t)}}(t,e,n,r,o):"config"===s?await async function(t,e,n,i,s,r){const o=i[s];try{if(o)await e[o];else{const t=(await Di(n)).find((t=>t.measurementId===s));t&&await e[t.appId]}}catch(t){Ni.error(t)}t("config",s,r)}(t,e,n,i,r,o):t("set",r)}catch(t){Ni.error(t)}}}(r,t,e,n),{gtagCore:r,wrappedGtag:window.gtag}}(Ui,Vi,ji);qi=t,Bi=e,zi=!0}return Ui[i]=async function(t,e,n,i,s,r,o){var a;const c=Pi(t);c.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Ni.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Ni.error(t))),e.push(c);const u=async function(){var t;if(!h())return Ni.warn(Ri.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await l()}catch(e){return Ni.warn(Ri.create("indexeddb-unavailable",{errorInfo:null===(t=e)||void 0===t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[d,f]=await Promise.all([c,u]);(function(){const t=window.document.getElementsByTagName("script");for(const e of Object.values(t))if(e.src&&e.src.includes(Ai))return e;return null})()||function(t,e){const n=document.createElement("script");n.src=`${Ai}?l=${t}&id=${e}`,n.async=!0,document.head.appendChild(n)}(r,d.measurementId),s("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),s("config",d.measurementId,p),d.measurementId}(t,Vi,ji,e,Bi,$i,n),new Fi(t)}const Hi="@firebase/analytics",Gi="0.7.11";at(new _(ki,((t,{options:e})=>Ki(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),at(new _("analytics-internal",(function(t){try{const e=t.getProvider(ki).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=T(t),async function(t,e,n,i,s){if(s&&s.global)t("event",n,i);else{const s=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(qi,Ui[t.app.options.appId],e,n,i).catch((t=>Ni.error(t)))}(e,t,n,i)}}catch(t){throw Ri.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),ft(Hi,Gi),ft(Hi,Gi,"esm2017");var Wi,Qi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},Xi={},Ji=Ji||{},Yi=Qi||self;function Zi(){}function ts(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function es(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ns="closure_uid_"+(1e9*Math.random()>>>0),is=0;function ss(t,e,n){return t.call.apply(t.bind,arguments)}function rs(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function os(t,e,n){return(os=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ss:rs).apply(null,arguments)}function as(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function cs(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function us(){this.s=this.s,this.o=this.o}var hs={};us.prototype.s=!1,us.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,ns)&&t[ns]||(t[ns]=++is)}(this);delete hs[t]}},us.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ls=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},ds=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const i=t.length,s="string"==typeof t?t.split(""):t;for(let r=0;r<i;r++)r in s&&e.call(n,s[r],r,t)};function fs(t){return Array.prototype.concat.apply([],arguments)}function ps(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function gs(t){return/^[\s\xa0]*$/.test(t)}var ms,ys=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function vs(t,e){return-1!=t.indexOf(e)}function ws(t,e){return t<e?-1:t>e?1:0}t:{var Is=Yi.navigator;if(Is){var Es=Is.userAgent;if(Es){ms=Es;break t}}ms=""}function bs(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Ts(t){const e={};for(const n in t)e[n]=t[n];return e}var _s="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ss(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<_s.length;e++)n=_s[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function Cs(t){return Cs[" "](t),t}Cs[" "]=Zi;var ks,As,Ns=vs(ms,"Opera"),Ds=vs(ms,"Trident")||vs(ms,"MSIE"),Rs=vs(ms,"Edge"),Os=Rs||Ds,Ls=vs(ms,"Gecko")&&!(vs(ms.toLowerCase(),"webkit")&&!vs(ms,"Edge"))&&!(vs(ms,"Trident")||vs(ms,"MSIE"))&&!vs(ms,"Edge"),Ps=vs(ms.toLowerCase(),"webkit")&&!vs(ms,"Edge");function Ms(){var t=Yi.document;return t?t.documentMode:void 0}t:{var xs="",Fs=(As=ms,Ls?/rv:([^\);]+)(\)|;)/.exec(As):Rs?/Edge\/([\d\.]+)/.exec(As):Ds?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(As):Ps?/WebKit\/(\S+)/.exec(As):Ns?/(?:Version)[ \/]?(\S+)/.exec(As):void 0);if(Fs&&(xs=Fs?Fs[1]:""),Ds){var Us=Ms();if(null!=Us&&Us>parseFloat(xs)){ks=String(Us);break t}}ks=xs}var Vs,js={};function Bs(){return t=js,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=ys(String(ks)).split("."),n=ys("9").split("."),i=Math.max(e.length,n.length);for(let o=0;0==t&&o<i;o++){var s=e[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;t=ws(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||ws(0==s[2].length,0==r[2].length)||ws(s[2],r[2]),s=s[3],r=r[3]}while(0==t)}return 0<=t}();var t}Yi.document&&Ds?Vs=Ms()||parseInt(ks,10)||void 0:Vs=void 0;var qs=Vs,$s=function(){if(!Yi.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Yi.addEventListener("test",Zi,e),Yi.removeEventListener("test",Zi,e)}catch(t){}return t}();function zs(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Ks(t,e){if(zs.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Ls){t:{try{Cs(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Hs[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ks.Z.h.call(this)}}zs.prototype.h=function(){this.defaultPrevented=!0},cs(Ks,zs);var Hs={2:"touch",3:"pen",4:"mouse"};Ks.prototype.h=function(){Ks.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Gs="closure_listenable_"+(1e6*Math.random()|0),Ws=0;function Qs(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ia=s,this.key=++Ws,this.ca=this.fa=!1}function Xs(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Js(t){this.src=t,this.g={},this.h=0}function Ys(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=ls(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Xs(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Zs(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.ca&&r.listener==e&&r.capture==!!n&&r.ia==i)return s}return-1}Js.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=Zs(t,e,i,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new Qs(e,this.src,r,!!i,s)).fa=n,t.push(e)),e};var tr="closure_lm_"+(1e6*Math.random()|0),er={};function nr(t,e,n,i,s){if(i&&i.once)return sr(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)nr(t,e[r],n,i,s);return null}return n=lr(n),t&&t[Gs]?t.N(e,n,es(i)?!!i.capture:!!i,s):ir(t,e,n,!1,i,s)}function ir(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=es(s)?!!s.capture:!!s,a=ur(t);if(a||(t[tr]=a=new Js(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){var t=cr;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)$s||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(ar(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function sr(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)sr(t,e[r],n,i,s);return null}return n=lr(n),t&&t[Gs]?t.O(e,n,es(i)?!!i.capture:!!i,s):ir(t,e,n,!0,i,s)}function rr(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)rr(t,e[r],n,i,s);else i=es(i)?!!i.capture:!!i,n=lr(n),t&&t[Gs]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Zs(r=t.g[e],n,i,s))&&(Xs(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=ur(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Zs(e,n,i,s)),(n=-1<t?e[t]:null)&&or(n))}function or(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Gs])Ys(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(ar(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=ur(e))?(Ys(n,t),0==n.h&&(n.src=null,e[tr]=null)):Xs(t)}}}function ar(t){return t in er?er[t]:er[t]="on"+t}function cr(t,e){if(t.ca)t=!0;else{e=new Ks(e,this);var n=t.listener,i=t.ia||t.src;t.fa&&or(t),t=n.call(i,e)}return t}function ur(t){return(t=t[tr])instanceof Js?t:null}var hr="__closure_events_fn_"+(1e9*Math.random()>>>0);function lr(t){return"function"==typeof t?t:(t[hr]||(t[hr]=function(e){return t.handleEvent(e)}),t[hr])}function dr(){us.call(this),this.i=new Js(this),this.P=this,this.I=null}function fr(t,e){var n,i=t.I;if(i)for(n=[];i;i=i.I)n.push(i);if(t=t.P,i=e.type||e,"string"==typeof e)e=new zs(e,t);else if(e instanceof zs)e.target=e.target||t;else{var s=e;Ss(e=new zs(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=pr(o,i,!0,e)&&s}if(s=pr(o=e.g=t,i,!0,e)&&s,s=pr(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=pr(o=e.g=n[r],i,!1,e)&&s}function pr(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Ys(t.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}cs(dr,us),dr.prototype[Gs]=!0,dr.prototype.removeEventListener=function(t,e,n,i){rr(this,t,e,n,i)},dr.prototype.M=function(){if(dr.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Xs(n[i]);delete e.g[t],e.h--}}this.I=null},dr.prototype.N=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},dr.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var gr=Yi.JSON.stringify;function mr(){var t=Tr;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var yr,vr=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new wr),(t=>t.reset()));class wr{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Ir(t){Yi.setTimeout((()=>{throw t}),0)}function Er(t,e){yr||function(){var t=Yi.Promise.resolve(void 0);yr=function(){t.then(_r)}}(),br||(yr(),br=!0),Tr.add(t,e)}var br=!1,Tr=new class{constructor(){this.h=this.g=null}add(t,e){const n=vr.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function _r(){for(var t;t=mr();){try{t.h.call(t.g)}catch(t){Ir(t)}var e=vr;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}br=!1}function Sr(t,e){dr.call(this),this.h=t||1,this.g=e||Yi,this.j=os(this.kb,this),this.l=Date.now()}function Cr(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function kr(t,e,n){if("function"==typeof t)n&&(t=os(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=os(t.handleEvent,t)}return 2147483647<Number(e)?-1:Yi.setTimeout(t,e||0)}function Ar(t){t.g=kr((()=>{t.g=null,t.i&&(t.i=!1,Ar(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}cs(Sr,dr),(Wi=Sr.prototype).da=!1,Wi.S=null,Wi.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),fr(this,"tick"),this.da&&(Cr(this),this.start()))}},Wi.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Wi.M=function(){Sr.Z.M.call(this),Cr(this),delete this.g};class Nr extends us{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Ar(this)}M(){super.M(),this.g&&(Yi.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Dr(t){us.call(this),this.h=t,this.g={}}cs(Dr,us);var Rr=[];function Or(t,e,n,i){Array.isArray(n)||(n&&(Rr[0]=n.toString()),n=Rr);for(var s=0;s<n.length;s++){var r=nr(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Lr(t){bs(t.g,(function(t,e){this.g.hasOwnProperty(e)&&or(t)}),t),t.g={}}function Pr(){this.g=!0}function Mr(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return gr(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}Dr.prototype.M=function(){Dr.Z.M.call(this),Lr(this)},Dr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Pr.prototype.Aa=function(){this.g=!1},Pr.prototype.info=function(){};var xr={},Fr=null;function Ur(){return Fr=Fr||new dr}function Vr(t){zs.call(this,xr.Ma,t)}function jr(t){const e=Ur();fr(e,new Vr(e,t))}function Br(t,e){zs.call(this,xr.STAT_EVENT,t),this.stat=e}function qr(t){const e=Ur();fr(e,new Br(e,t))}function $r(t,e){zs.call(this,xr.Na,t),this.size=e}function zr(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Yi.setTimeout((function(){t()}),e)}xr.Ma="serverreachability",cs(Vr,zs),xr.STAT_EVENT="statevent",cs(Br,zs),xr.Na="timingevent",cs($r,zs);var Kr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Hr={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Gr(){}function Wr(t){return t.h||(t.h=t.i())}function Qr(){}Gr.prototype.h=null;var Xr,Jr={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Yr(){zs.call(this,"d")}function Zr(){zs.call(this,"c")}function to(){}function eo(t,e,n,i){this.l=t,this.j=e,this.m=n,this.X=i||1,this.V=new Dr(this),this.P=io,t=Os?125:void 0,this.W=new Sr(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new no}function no(){this.i=null,this.g="",this.h=!1}cs(Yr,zs),cs(Zr,zs),cs(to,Gr),to.prototype.g=function(){return new XMLHttpRequest},to.prototype.i=function(){return{}},Xr=new to;var io=45e3,so={},ro={};function oo(t,e,n){t.K=1,t.v=Do(_o(e)),t.s=n,t.U=!0,ao(t,null)}function ao(t,e){t.F=Date.now(),lo(t),t.A=_o(t.v);var n=t.A,i=t.X;Array.isArray(i)||(i=[String(i)]),$o(n.h,"t",i),t.C=0,n=t.l.H,t.h=new no,t.g=$a(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Nr(os(t.Ia,t,t.g),t.O)),Or(t.V,t.g,"readystatechange",t.gb),e=t.H?Ts(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),jr(1),function(t,e,n,i,s,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function co(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function uo(t,e,n){let i,s=!0;for(;!t.I&&t.C<n.length;){if(i=ho(t,n),i==ro){4==e&&(t.o=4,qr(14),s=!1),Mr(t.j,t.m,null,"[Incomplete Response]");break}if(i==so){t.o=4,qr(15),Mr(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Mr(t.j,t.m,i,null),yo(t,i)}co(t)&&i!=ro&&i!=so&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,qr(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ma(e),e.L=!0,qr(11))):(Mr(t.j,t.m,n,"[Invalid Chunked Response]"),mo(t),go(t))}function ho(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?ro:(n=Number(e.substring(n,i)),isNaN(n)?so:(i+=1)+n>e.length?ro:(e=e.substr(i,n),t.C=i+n,e))}function lo(t){t.Y=Date.now()+t.P,fo(t,t.P)}function fo(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=zr(os(t.eb,t),e)}function po(t){t.B&&(Yi.clearTimeout(t.B),t.B=null)}function go(t){0==t.l.G||t.I||Ua(t.l,t)}function mo(t){po(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Cr(t.W),Lr(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function yo(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Qo(n.i,t)))if(n.I=t.N,!t.J&&Qo(n.i,t)&&3==n.G){try{var i=n.Ca.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Fa(n),Ca(n)}Pa(n),qr(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=zr(os(n.ab,n),6e3));if(1>=Wo(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else ja(n,11)}else if((t.J||n.g==t)&&Fa(n),!gs(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const e=u[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const s=u[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.K=i,n.h.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.i;!r.g&&(vs(t,"spdy")||vs(t,"quic")||vs(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(Xo(r,r.h),r.h=null))}if(i.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.sa=t,No(i.F,i.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((i=n).oa=qa(i,i.H?i.la:null,i.W),o.J){Jo(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(po(a),lo(a)),i.g=o}else La(i);0<n.l.length&&Na(n)}else"stop"!=u[0]&&"close"!=u[0]||ja(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ja(n,7):Sa(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}jr(4)}catch(t){}}function vo(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ts(t)||"string"==typeof t)ds(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(ts(t)||"string"==typeof t){n=[];for(var i=t.length,s=0;s<i;s++)n.push(s)}else for(s in n=[],i=0,t)n[i++]=s;i=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(ts(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),s=i.length;for(var r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}}function wo(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof wo)for(n=t.T(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function Io(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var i=t.g[e];Eo(t.h,i)&&(t.g[n++]=i),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)Eo(s,i=t.g[e])||(t.g[n++]=i,s[i]=1),e++;t.g.length=n}}function Eo(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Wi=eo.prototype).setTimeout=function(t){this.P=t},Wi.gb=function(t){t=t.target;const e=this.L;e&&3==Ia(t)?e.l():this.Ia(t)},Wi.Ia=function(t){try{if(t==this.g)t:{const h=Ia(this.g);var e=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||Os||this.g&&(this.h.h||this.g.ga()||Ea(this.g)))){this.I||4!=h||7==e||jr(8==e||0>=l?3:2),po(this);var n=this.g.ba();this.N=n;e:if(co(this)){var i=Ea(this.g);t="";var s=i.length,r=4==Ia(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){mo(this),go(this);var o="";break e}this.h.i=new Yi.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!gs(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,qr(12),mo(this),go(this);break t}Mr(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,yo(this,n)}this.U?(uo(this,h,o),Os&&this.i&&3==h&&(Or(this.V,this.W,"tick",this.fb),this.W.start())):(Mr(this.j,this.m,o,null),yo(this,o)),4==h&&mo(this),this.i&&!this.I&&(4==h?Ua(this.l,this):(this.i=!1,lo(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,qr(12)):(this.o=0,qr(13)),mo(this),go(this)}}}catch(t){}},Wi.fb=function(){if(this.g){var t=Ia(this.g),e=this.g.ga();this.C<e.length&&(po(this),uo(this,t,e),this.i&&4!=t&&lo(this))}},Wi.cancel=function(){this.I=!0,mo(this)},Wi.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(jr(3),qr(17)),mo(this),this.o=2,go(this)):fo(this,this.Y-t)},(Wi=wo.prototype).R=function(){Io(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},Wi.T=function(){return Io(this),this.g.concat()},Wi.get=function(t,e){return Eo(this.h,t)?this.h[t]:e},Wi.set=function(t,e){Eo(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},Wi.forEach=function(t,e){for(var n=this.T(),i=0;i<n.length;i++){var s=n[i],r=this.get(s);t.call(e,r,s,this)}};var bo=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function To(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof To){this.g=void 0!==e?e:t.g,So(this,t.j),this.s=t.s,Co(this,t.i),ko(this,t.m),this.l=t.l,e=t.h;var n=new Vo;n.i=e.i,e.g&&(n.g=new wo(e.g),n.h=e.h),Ao(this,n),this.o=t.o}else t&&(n=String(t).match(bo))?(this.g=!!e,So(this,n[1]||"",!0),this.s=Ro(n[2]||""),Co(this,n[3]||"",!0),ko(this,n[4]),this.l=Ro(n[5]||"",!0),Ao(this,n[6]||"",!0),this.o=Ro(n[7]||"")):(this.g=!!e,this.h=new Vo(null,this.g))}function _o(t){return new To(t)}function So(t,e,n){t.j=n?Ro(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Co(t,e,n){t.i=n?Ro(e,!0):e}function ko(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ao(t,e,n){e instanceof Vo?(t.h=e,function(t,e){e&&!t.j&&(jo(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Bo(this,e),$o(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=Oo(e,Fo)),t.h=new Vo(e,t.g))}function No(t,e,n){t.h.set(e,n)}function Do(t){return No(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ro(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Oo(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Lo),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Lo(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}To.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Oo(e,Po,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Oo(e,Po,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Oo(n,"/"==n.charAt(0)?xo:Mo,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Oo(n,Uo)),t.join("")};var Po=/[#\/\?@]/g,Mo=/[#\?:]/g,xo=/[#\?]/g,Fo=/[#\?@]/g,Uo=/#/g;function Vo(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function jo(t){t.g||(t.g=new wo,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Bo(t,e){jo(t),e=zo(t,e),Eo(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Eo((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Io(t)))}function qo(t,e){return jo(t),e=zo(t,e),Eo(t.g.h,e)}function $o(t,e,n){Bo(t,e),0<n.length&&(t.i=null,t.g.set(zo(t,e),ps(n)),t.h+=n.length)}function zo(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ko(t){this.l=t||Ho,t=Yi.PerformanceNavigationTiming?0<(t=Yi.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Yi.g&&Yi.g.Ea&&Yi.g.Ea()&&Yi.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Wi=Vo.prototype).add=function(t,e){jo(this),this.i=null,t=zo(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Wi.forEach=function(t,e){jo(this),this.g.forEach((function(n,i){ds(n,(function(n){t.call(e,n,i,this)}),this)}),this)},Wi.T=function(){jo(this);for(var t=this.g.R(),e=this.g.T(),n=[],i=0;i<e.length;i++)for(var s=t[i],r=0;r<s.length;r++)n.push(e[i]);return n},Wi.R=function(t){jo(this);var e=[];if("string"==typeof t)qo(this,t)&&(e=fs(e,this.g.get(zo(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=fs(e,t[n])}return e},Wi.set=function(t,e){return jo(this),this.i=null,qo(this,t=zo(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Wi.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},Wi.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var i=e[n],s=encodeURIComponent(String(i));i=this.R(i);for(var r=0;r<i.length;r++){var o=s;""!==i[r]&&(o+="="+encodeURIComponent(String(i[r]))),t.push(o)}}return this.i=t.join("&")};var Ho=10;function Go(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Wo(t){return t.h?1:t.g?t.g.size:0}function Qo(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Xo(t,e){t.g?t.g.add(e):t.h=e}function Jo(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Yo(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return ps(t.i)}function Zo(){}function ta(){this.g=new Zo}function ea(t,e,n){const i=n||"";try{vo(t,(function(t,n){let s=t;es(t)&&(s=gr(t)),e.push(i+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function na(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function ia(t){this.l=t.$b||null,this.j=t.ib||!1}function sa(t,e){dr.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=ra,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ko.prototype.cancel=function(){if(this.i=Yo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Zo.prototype.stringify=function(t){return Yi.JSON.stringify(t,void 0)},Zo.prototype.parse=function(t){return Yi.JSON.parse(t,void 0)},cs(ia,Gr),ia.prototype.g=function(){return new sa(this.l,this.j)},ia.prototype.i=function(t){return function(){return t}}({}),cs(sa,dr);var ra=0;function oa(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function aa(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ca(t)}function ca(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Wi=sa.prototype).open=function(t,e){if(this.readyState!=ra)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ca(this)},Wi.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||Yi).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},Wi.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,aa(this)),this.readyState=ra},Wi.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ca(this)),this.g&&(this.readyState=3,ca(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Yi.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;oa(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},Wi.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?aa(this):ca(this),3==this.readyState&&oa(this)}},Wi.Ua=function(t){this.g&&(this.response=this.responseText=t,aa(this))},Wi.Ta=function(t){this.g&&(this.response=t,aa(this))},Wi.ha=function(){this.g&&aa(this)},Wi.setRequestHeader=function(t,e){this.v.append(t,e)},Wi.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Wi.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(sa.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var ua=Yi.JSON.parse;function ha(t){dr.call(this),this.headers=new wo,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=la,this.K=this.L=!1}cs(ha,dr);var la="",da=/^https?$/i,fa=["POST","PUT"];function pa(t){return"content-type"==t.toLowerCase()}function ga(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,ma(t),va(t)}function ma(t){t.D||(t.D=!0,fr(t,"complete"),fr(t,"error"))}function ya(t){if(t.h&&void 0!==Ji&&(!t.C[1]||4!=Ia(t)||2!=t.ba()))if(t.v&&4==Ia(t))kr(t.Fa,0,t);else if(fr(t,"readystatechange"),4==Ia(t)){t.h=!1;try{const a=t.ba();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===a){var s=String(t.H).match(bo)[1]||null;if(!s&&Yi.self&&Yi.self.location){var r=Yi.self.location.protocol;s=r.substr(0,r.length-1)}i=!da.test(s?s.toLowerCase():"")}n=i}if(n)fr(t,"complete"),fr(t,"success");else{t.m=6;try{var o=2<Ia(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.ba()+"]",ma(t)}}finally{va(t)}}}function va(t,e){if(t.g){wa(t);const n=t.g,i=t.C[0]?Zi:null;t.g=null,t.C=null,e||fr(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function wa(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(Yi.clearTimeout(t.A),t.A=null)}function Ia(t){return t.g?t.g.readyState:0}function Ea(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case la:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function ba(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=function(t){let e="";return bs(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):No(t,e,n))}function Ta(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function _a(t){this.za=0,this.l=[],this.h=new Pr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Ta("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Ta("baseRetryDelayMs",5e3,t),this.$a=Ta("retryDelaySeedMs",1e4,t),this.Ya=Ta("forwardChannelMaxRetries",2,t),this.ra=Ta("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Ko(t&&t.concurrentRequestLimit),this.Ca=new ta,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Sa(t){if(ka(t),3==t.G){var e=t.V++,n=_o(t.F);No(n,"SID",t.J),No(n,"RID",e),No(n,"TYPE","terminate"),Ra(t,n),(e=new eo(t,t.h,e,void 0)).K=2,e.v=Do(_o(n)),n=!1,Yi.navigator&&Yi.navigator.sendBeacon&&(n=Yi.navigator.sendBeacon(e.v.toString(),"")),!n&&Yi.Image&&((new Image).src=e.v,n=!0),n||(e.g=$a(e.l,null),e.g.ea(e.v)),e.F=Date.now(),lo(e)}Ba(t)}function Ca(t){t.g&&(Ma(t),t.g.cancel(),t.g=null)}function ka(t){Ca(t),t.u&&(Yi.clearTimeout(t.u),t.u=null),Fa(t),t.i.cancel(),t.m&&("number"==typeof t.m&&Yi.clearTimeout(t.m),t.m=null)}function Aa(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&Na(t)}function Na(t){Go(t.i)||t.m||(t.m=!0,Er(t.Ha,t),t.C=0)}function Da(t,e){var n;n=e?e.m:t.V++;const i=_o(t.F);No(i,"SID",t.J),No(i,"RID",n),No(i,"AID",t.U),Ra(t,i),t.o&&t.s&&ba(i,t.o,t.s),n=new eo(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Oa(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Xo(t.i,n),oo(n,i,e)}function Ra(t,e){t.j&&vo({},(function(t,n){No(e,n,t)}))}function Oa(t,e,n){n=Math.min(t.l.length,n);var i=t.j?os(t.j.Oa,t.j,t):null;t:{var s=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),r=!1;else try{ea(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(r){i=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,i}function La(t){t.g||t.u||(t.Y=1,Er(t.Ga,t),t.A=0)}function Pa(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=zr(os(t.Ga,t),Va(t,t.A)),t.A++,0))}function Ma(t){null!=t.B&&(Yi.clearTimeout(t.B),t.B=null)}function xa(t){t.g=new eo(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=_o(t.oa);No(e,"RID","rpc"),No(e,"SID",t.J),No(e,"CI",t.N?"0":"1"),No(e,"AID",t.U),Ra(t,e),No(e,"TYPE","xmlhttp"),t.o&&t.s&&ba(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Do(_o(e)),n.s=null,n.U=!0,ao(n,t)}function Fa(t){null!=t.v&&(Yi.clearTimeout(t.v),t.v=null)}function Ua(t,e){var n=null;if(t.g==e){Fa(t),Ma(t),t.g=null;var i=2}else{if(!Qo(t.i,e))return;n=e.D,Jo(t.i,e),i=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;fr(i=Ur(),new $r(i,n,e,s)),Na(t)}else La(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==i&&function(t,e){return!(Wo(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=zr(os(t.Ha,t,e),Va(t,t.C)),t.C++,0)))}(t,e)||2==i&&Pa(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:ja(t,5);break;case 4:ja(t,10);break;case 3:ja(t,6);break;default:ja(t,2)}}function Va(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function ja(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var i=os(t.jb,t);n||(n=new To("//www.google.com/images/cleardot.gif"),Yi.location&&"http"==Yi.location.protocol||So(n,"https"),Do(n)),function(t,e){const n=new Pr;if(Yi.Image){const i=new Image;i.onload=as(na,n,i,"TestLoadImage: loaded",!0,e),i.onerror=as(na,n,i,"TestLoadImage: error",!1,e),i.onabort=as(na,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=as(na,n,i,"TestLoadImage: timeout",!1,e),Yi.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else qr(2);t.G=0,t.j&&t.j.va(e),Ba(t),ka(t)}function Ba(t){t.G=0,t.I=-1,t.j&&(0==Yo(t.i).length&&0==t.l.length||(t.i.i.length=0,ps(t.l),t.l.length=0),t.j.ua())}function qa(t,e,n){let i=function(t){return t instanceof To?_o(t):new To(t,void 0)}(n);if(""!=i.i)e&&Co(i,e+"."+i.i),ko(i,i.m);else{const t=Yi.location;i=function(t,e,n,i){var s=new To(null,void 0);return t&&So(s,t),e&&Co(s,e),n&&ko(s,n),i&&(s.l=i),s}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&bs(t.aa,(function(t,e){No(i,e,t)})),e=t.D,n=t.sa,e&&n&&No(i,e,n),No(i,"VER",t.ma),Ra(t,i),i}function $a(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new ha(new ia({ib:!0})):new ha(t.qa)).L=t.H,e}function za(){}function Ka(){if(Ds&&!(10<=Number(qs)))throw Error("Environmental error: no available transport.")}function Ha(t,e){dr.call(this),this.g=new _a(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!gs(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!gs(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Qa(this)}function Ga(t){Yr.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Wa(){Zr.call(this),this.status=1}function Qa(t){this.g=t}(Wi=ha.prototype).ea=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Xr.g(),this.C=this.u?Wr(this.u):Wr(Xr),this.g.onreadystatechange=os(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void ga(this,t)}t=n||"";const s=new wo(this.headers);i&&vo(i,(function(t,e){s.set(e,t)})),i=function(t){t:{var e=pa;const n=t.length,i="string"==typeof t?t.split(""):t;for(let s=0;s<n;s++)if(s in i&&e.call(void 0,i[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.T()),n=Yi.FormData&&t instanceof Yi.FormData,!(0<=ls(fa,e))||i||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{wa(this),0<this.B&&((this.K=function(t){return Ds&&Bs()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=os(this.pa,this)):this.A=kr(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){ga(this,t)}},Wi.pa=function(){void 0!==Ji&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,fr(this,"timeout"),this.abort(8))},Wi.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,fr(this,"complete"),fr(this,"abort"),va(this))},Wi.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),va(this,!0)),ha.Z.M.call(this)},Wi.Fa=function(){this.s||(this.F||this.v||this.l?ya(this):this.cb())},Wi.cb=function(){ya(this)},Wi.ba=function(){try{return 2<Ia(this)?this.g.status:-1}catch(t){return-1}},Wi.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},Wi.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ua(e)}},Wi.Da=function(){return this.m},Wi.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Wi=_a.prototype).ma=8,Wi.G=1,Wi.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},Wi.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new eo(this,this.h,t,void 0);let r=this.s;if(this.P&&(r?(r=Ts(r),Ss(r,this.P)):r=this.P),null===this.o&&(s.H=r),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var i=this.l[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Oa(this,s,e),No(n=_o(this.F),"RID",t),No(n,"CVER",22),this.D&&No(n,"X-HTTP-Session-Id",this.D),Ra(this,n),this.o&&r&&ba(n,this.o,r),Xo(this.i,s),this.Ra&&No(n,"TYPE","init"),this.ja?(No(n,"$req",e),No(n,"SID","null"),s.$=!0,oo(s,n,null)):oo(s,n,e),this.G=2}}else 3==this.G&&(t?Da(this,t):0==this.l.length||Go(this.i)||Da(this))},Wi.Ga=function(){if(this.u=null,xa(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=zr(os(this.bb,this),t)}},Wi.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,qr(10),Ca(this),xa(this))},Wi.ab=function(){null!=this.v&&(this.v=null,Ca(this),Pa(this),qr(19))},Wi.jb=function(t){t?(this.h.info("Successfully pinged google.com"),qr(2)):(this.h.info("Failed to ping google.com"),qr(1))},(Wi=za.prototype).xa=function(){},Wi.wa=function(){},Wi.va=function(){},Wi.ua=function(){},Wi.Oa=function(){},Ka.prototype.g=function(t,e){return new Ha(t,e)},cs(Ha,dr),Ha.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Er(os(t.hb,t,e))),qr(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=qa(t,null,t.W),Na(t)},Ha.prototype.close=function(){Sa(this.g)},Ha.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Aa(this.g,e)}else this.v?((e={}).__data__=gr(t),Aa(this.g,e)):Aa(this.g,t)},Ha.prototype.M=function(){this.g.j=null,delete this.j,Sa(this.g),delete this.g,Ha.Z.M.call(this)},cs(Ga,Yr),cs(Wa,Zr),cs(Qa,za),Qa.prototype.xa=function(){fr(this.g,"a")},Qa.prototype.wa=function(t){fr(this.g,new Ga(t))},Qa.prototype.va=function(t){fr(this.g,new Wa(t))},Qa.prototype.ua=function(){fr(this.g,"b")},Ka.prototype.createWebChannel=Ka.prototype.g,Ha.prototype.send=Ha.prototype.u,Ha.prototype.open=Ha.prototype.m,Ha.prototype.close=Ha.prototype.close,Kr.NO_ERROR=0,Kr.TIMEOUT=8,Kr.HTTP_ERROR=6,Hr.COMPLETE="complete",Qr.EventType=Jr,Jr.OPEN="a",Jr.CLOSE="b",Jr.ERROR="c",Jr.MESSAGE="d",dr.prototype.listen=dr.prototype.N,ha.prototype.listenOnce=ha.prototype.O,ha.prototype.getLastError=ha.prototype.La,ha.prototype.getLastErrorCode=ha.prototype.Da,ha.prototype.getStatus=ha.prototype.ba,ha.prototype.getResponseJson=ha.prototype.Qa,ha.prototype.getResponseText=ha.prototype.ga,ha.prototype.send=ha.prototype.ea;var Xa=Xi.createWebChannelTransport=function(){return new Ka},Ja=Xi.getStatEventTarget=function(){return Ur()},Ya=Xi.ErrorCode=Kr,Za=Xi.EventType=Hr,tc=Xi.Event=xr,ec=Xi.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},nc=Xi.FetchXmlHttpFactory=ia,ic=Xi.WebChannel=Qr,sc=Xi.XhrIo=ha;const rc="@firebase/firestore";class oc{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}oc.UNAUTHENTICATED=new oc(null),oc.GOOGLE_CREDENTIALS=new oc("google-credentials-uid"),oc.FIRST_PARTY=new oc("first-party-uid"),oc.MOCK_USER=new oc("mock-user");let ac="9.8.4";const cc=new M("@firebase/firestore");function uc(){return cc.logLevel}function hc(t,...e){if(cc.logLevel<=N.DEBUG){const n=e.map(fc);cc.debug(`Firestore (${ac}): ${t}`,...n)}}function lc(t,...e){if(cc.logLevel<=N.ERROR){const n=e.map(fc);cc.error(`Firestore (${ac}): ${t}`,...n)}}function dc(t,...e){if(cc.logLevel<=N.WARN){const n=e.map(fc);cc.warn(`Firestore (${ac}): ${t}`,...n)}}function fc(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function pc(t="Unexpected state"){const e=`FIRESTORE (${ac}) INTERNAL ASSERTION FAILED: `+t;throw lc(e),new Error(e)}function gc(t,e){t||pc()}function mc(t,e){return t}const yc={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class vc extends d{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class wc{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Ic{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Ec{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(oc.UNAUTHENTICATED)))}shutdown(){}}class bc{constructor(t){this.t=t,this.currentUser=oc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new wc;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new wc,t.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{hc("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(hc("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new wc)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(hc("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(gc("string"==typeof e.accessToken),new Ic(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return gc(null===t||"string"==typeof t),new oc(t)}}class Tc{constructor(t,e,n){this.type="FirstParty",this.user=oc.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class _c{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new Tc(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(oc.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Sc{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Cc{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&hc("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,hc("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{hc("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?i(t):hc("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(gc("string"==typeof t.token),this.p=t.token,new Sc(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function kc(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Ac{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const i=kc(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}}function Nc(t,e){return t<e?-1:t>e?1:0}function Dc(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class Rc{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new vc(yc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new vc(yc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new vc(yc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new vc(yc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Rc.fromMillis(Date.now())}static fromDate(t){return Rc.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Rc(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Nc(this.nanoseconds,t.nanoseconds):Nc(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Oc{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Oc(t)}static min(){return new Oc(new Rc(0,0))}static max(){return new Oc(new Rc(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Lc{constructor(t,e,n){void 0===e?e=0:e>t.length&&pc(),void 0===n?n=t.length-e:n>t.length-e&&pc(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Lc.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Lc?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Pc extends Lc{construct(t,e,n){return new Pc(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new vc(yc.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Pc(e)}static emptyPath(){return new Pc([])}}const Mc=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class xc extends Lc{construct(t,e,n){return new xc(t,e,n)}static isValidIdentifier(t){return Mc.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),xc.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new xc(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new vc(yc.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new vc(yc.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new vc(yc.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(r=!r,i++):"."!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new vc(yc.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new xc(e)}static emptyPath(){return new xc([])}}class Fc{constructor(t){this.path=t}static fromPath(t){return new Fc(Pc.fromString(t))}static fromName(t){return new Fc(Pc.fromString(t).popFirst(5))}static empty(){return new Fc(Pc.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Pc.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Pc.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Fc(new Pc(t.slice()))}}function Uc(t){return new Vc(t.readTime,t.key,-1)}class Vc{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Vc(Oc.min(),Fc.empty(),-1)}static max(){return new Vc(Oc.max(),Fc.empty(),-1)}}function jc(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Fc.comparator(t.documentKey,e.documentKey),0!==n?n:Nc(t.largestBatchId,e.largestBatchId))}async function Bc(t){if(t.code!==yc.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;hc("LocalStore","Unexpectedly lost primary lease")}class qc{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&pc(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new qc(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof qc?e:qc.resolve(e)}catch(t){return qc.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):qc.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):qc.reject(e)}static resolve(t){return new qc(((e,n)=>{e(t)}))}static reject(t){return new qc(((e,n)=>{n(t)}))}static waitFor(t){return new qc(((e,n)=>{let i=0,s=0,r=!1;t.forEach((t=>{++i,t.next((()=>{++s,r&&s===i&&e()}),(t=>n(t)))})),r=!0,s===i&&e()}))}static or(t){let e=qc.resolve(!1);for(const n of t)e=e.next((t=>t?qc.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new qc(((n,i)=>{const s=t.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{r[c]=t,++o,o===s&&n(r)}),(t=>i(t)))}}))}static doWhile(t,e){return new qc(((n,i)=>{const s=()=>{!0===t()?e().next((()=>{s()}),i):n()};s()}))}}function $c(t){return"IndexedDbTransactionError"===t.name}class zc{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.it(t),this.rt=t=>e.writeSequenceNumber(t))}it(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.rt&&this.rt(t),t}}function Kc(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Hc(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Gc(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}zc.ot=-1;class Wc{constructor(t,e){this.comparator=t,this.root=e||Xc.EMPTY}insert(t,e){return new Wc(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Xc.BLACK,null,null))}remove(t){return new Wc(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Xc.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Qc(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Qc(this.root,t,this.comparator,!1)}getReverseIterator(){return new Qc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Qc(this.root,t,this.comparator,!0)}}class Qc{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Xc{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Xc.RED,this.left=null!=i?i:Xc.EMPTY,this.right=null!=s?s:Xc.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new Xc(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Xc.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Xc.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Xc.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Xc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw pc();if(this.right.isRed())throw pc();const t=this.left.check();if(t!==this.right.check())throw pc();return t+(this.isRed()?0:1)}}Xc.EMPTY=null,Xc.RED=!0,Xc.BLACK=!1,Xc.EMPTY=new class{constructor(){this.size=0}get key(){throw pc()}get value(){throw pc()}get color(){throw pc()}get left(){throw pc()}get right(){throw pc()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Xc(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Jc{constructor(t){this.comparator=t,this.data=new Wc(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Yc(this.data.getIterator())}getIteratorFrom(t){return new Yc(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Jc))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Jc(this.comparator);return e.data=t,e}}class Yc{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Zc{constructor(t){this.fields=t,t.sort(xc.comparator)}static empty(){return new Zc([])}unionWith(t){let e=new Jc(xc.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Zc(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Dc(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class tu{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new tu(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new tu(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Nc(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}tu.EMPTY_BYTE_STRING=new tu("");const eu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nu(t){if(gc(!!t),"string"==typeof t){let e=0;const n=eu.exec(t);if(gc(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:iu(t.seconds),nanos:iu(t.nanos)}}function iu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function su(t){return"string"==typeof t?tu.fromBase64String(t):tu.fromUint8Array(t)}function ru(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ou(t){const e=t.mapValue.fields.__previous_value__;return ru(e)?ou(e):e}function au(t){const e=nu(t.mapValue.fields.__local_write_time__.timestampValue);return new Rc(e.seconds,e.nanos)}class cu{constructor(t,e,n,i,s,r,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class uu{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new uu("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof uu&&t.projectId===this.projectId&&t.database===this.database}}function hu(t){return null==t}function lu(t){return 0===t&&1/t==-1/0}const du={fields:{__type__:{stringValue:"__max__"}}};function fu(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ru(t)?4:Cu(t)?9007199254740991:10:pc()}function pu(t,e){if(t===e)return!0;const n=fu(t);if(n!==fu(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return au(t).isEqual(au(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=nu(t.timestampValue),i=nu(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return su(t.bytesValue).isEqual(su(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return iu(t.geoPointValue.latitude)===iu(e.geoPointValue.latitude)&&iu(t.geoPointValue.longitude)===iu(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return iu(t.integerValue)===iu(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=iu(t.doubleValue),i=iu(e.doubleValue);return n===i?lu(n)===lu(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return Dc(t.arrayValue.values||[],e.arrayValue.values||[],pu);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(Kc(n)!==Kc(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!pu(n[t],i[t])))return!1;return!0}(t,e);default:return pc()}}function gu(t,e){return void 0!==(t.values||[]).find((t=>pu(t,e)))}function mu(t,e){if(t===e)return 0;const n=fu(t),i=fu(e);if(n!==i)return Nc(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Nc(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=iu(t.integerValue||t.doubleValue),i=iu(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return yu(t.timestampValue,e.timestampValue);case 4:return yu(au(t),au(e));case 5:return Nc(t.stringValue,e.stringValue);case 6:return function(t,e){const n=su(t),i=su(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=Nc(n[t],i[t]);if(0!==e)return e}return Nc(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Nc(iu(t.latitude),iu(e.latitude));return 0!==n?n:Nc(iu(t.longitude),iu(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=mu(n[t],i[t]);if(e)return e}return Nc(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===du&&e===du)return 0;if(t===du)return 1;if(e===du)return-1;const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let t=0;t<i.length&&t<r.length;++t){const e=Nc(i[t],r[t]);if(0!==e)return e;const o=mu(n[i[t]],s[r[t]]);if(0!==o)return o}return Nc(i.length,r.length)}(t.mapValue,e.mapValue);default:throw pc()}}function yu(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Nc(t,e);const n=nu(t),i=nu(e),s=Nc(n.seconds,i.seconds);return 0!==s?s:Nc(n.nanos,i.nanos)}function vu(t){return wu(t)}function wu(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=nu(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?su(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Fc.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=wu(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const s of e)i?i=!1:n+=",",n+=`${s}:${wu(t.fields[s])}`;return n+"}"}(t.mapValue):pc();var e,n}function Iu(t){return!!t&&"integerValue"in t}function Eu(t){return!!t&&"arrayValue"in t}function bu(t){return!!t&&"nullValue"in t}function Tu(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function _u(t){return!!t&&"mapValue"in t}function Su(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Hc(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Su(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Su(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Cu(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class ku{constructor(t){this.value=t}static empty(){return new ku({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!_u(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Su(e)}setAll(t){let e=xc.emptyPath(),n={},i=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=Su(t):i.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());_u(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return pu(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];_u(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Hc(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new ku(Su(this.value))}}function Au(t){const e=[];return Hc(t.fields,((t,n)=>{const i=new xc([t]);if(_u(n)){const t=Au(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)})),new Zc(e)}class Nu{constructor(t,e,n,i,s,r){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.data=s,this.documentState=r}static newInvalidDocument(t){return new Nu(t,0,Oc.min(),Oc.min(),ku.empty(),0)}static newFoundDocument(t,e,n){return new Nu(t,1,e,Oc.min(),n,0)}static newNoDocument(t,e){return new Nu(t,2,e,Oc.min(),ku.empty(),0)}static newUnknownDocument(t,e){return new Nu(t,3,e,Oc.min(),ku.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ku.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ku.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Oc.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Nu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Nu(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Du{constructor(t,e=null,n=[],i=[],s=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.ut=null}}function Ru(t,e=null,n=[],i=[],s=null,r=null,o=null){return new Du(t,e,n,i,s,r,o)}function Ou(t){const e=mc(t);if(null===e.ut){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+vu(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),hu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>vu(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>vu(t))).join(",")),e.ut=t}return e.ut}function Lu(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Hu(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],i=e.filters[s],n.op!==i.op||!n.field.isEqual(i.field)||!pu(n.value,i.value))return!1;var n,i;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Wu(t.startAt,e.startAt)&&Wu(t.endAt,e.endAt)}function Pu(t){return Fc.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Mu extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.ct(t,e,n):new xu(t,e,n):"array-contains"===e?new ju(t,n):"in"===e?new Bu(t,n):"not-in"===e?new qu(t,n):"array-contains-any"===e?new $u(t,n):new Mu(t,e,n)}static ct(t,e,n){return"in"===e?new Fu(t,n):new Uu(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.at(mu(e,this.value)):null!==e&&fu(this.value)===fu(e)&&this.at(mu(e,this.value))}at(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return pc()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class xu extends Mu{constructor(t,e,n){super(t,e,n),this.key=Fc.fromName(n.referenceValue)}matches(t){const e=Fc.comparator(t.key,this.key);return this.at(e)}}class Fu extends Mu{constructor(t,e){super(t,"in",e),this.keys=Vu(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Uu extends Mu{constructor(t,e){super(t,"not-in",e),this.keys=Vu(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Vu(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Fc.fromName(t.referenceValue)))}class ju extends Mu{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Eu(e)&&gu(e.arrayValue,this.value)}}class Bu extends Mu{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&gu(this.value.arrayValue,e)}}class qu extends Mu{constructor(t,e){super(t,"not-in",e)}matches(t){if(gu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!gu(this.value.arrayValue,e)}}class $u extends Mu{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Eu(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>gu(this.value.arrayValue,t)))}}class zu{constructor(t,e){this.position=t,this.inclusive=e}}class Ku{constructor(t,e="asc"){this.field=t,this.dir=e}}function Hu(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Gu(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?Fc.comparator(Fc.fromName(o.referenceValue),n.key):mu(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function Wu(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!pu(t.position[n],e.position[n]))return!1;return!0}class Qu{constructor(t,e=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.lt=null,this.ft=null,this.startAt,this.endAt}}function Xu(t){return new Qu(t)}function Ju(t){const e=mc(t);if(null===e.lt){e.lt=[];const t=function(t){for(const e of t.filters)if(e.ht())return e.field;return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.lt.push(new Ku(t)),e.lt.push(new Ku(xc.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.lt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new Ku(xc.keyField(),t))}}}return e.lt}function Yu(t){const e=mc(t);if(!e.ft)if("F"===e.limitType)e.ft=Ru(e.path,e.collectionGroup,Ju(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Ju(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Ku(n.field,e))}const n=e.endAt?new zu(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new zu(e.startAt.position,e.startAt.inclusive):null;e.ft=Ru(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.ft}function Zu(t,e){return Lu(Yu(t),Yu(e))&&t.limitType===e.limitType}function th(t){return`${Ou(Yu(t))}|lt:${t.limitType}`}function eh(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${vu(e.value)}`;var e})).join(", ")}]`),hu(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>vu(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>vu(t))).join(",")),`Target(${e})`}(Yu(t))}; limitType=${t.limitType})`}function nh(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Fc.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=Gu(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Ju(t),e)||t.endAt&&!function(t,e,n){const i=Gu(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Ju(t),e))}(t,e)}function ih(t){return(e,n)=>{let i=!1;for(const s of Ju(t)){const t=sh(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}function sh(t,e,n){const i=t.field.isKeyField()?Fc.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?mu(i,s):pc()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return pc()}}function rh(t,e){if(t.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lu(e)?"-0":e}}function oh(t){return{integerValue:""+t}}function ah(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!lu(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?oh(e):rh(t,e)}class ch{constructor(){this._=void 0}}function uh(t,e,n){return t instanceof dh?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof fh?ph(t,e):t instanceof gh?mh(t,e):function(t,e){const n=lh(t,e),i=vh(n)+vh(t._t);return Iu(n)&&Iu(t._t)?oh(i):rh(t.wt,i)}(t,e)}function hh(t,e,n){return t instanceof fh?ph(t,e):t instanceof gh?mh(t,e):n}function lh(t,e){return t instanceof yh?Iu(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class dh extends ch{}class fh extends ch{constructor(t){super(),this.elements=t}}function ph(t,e){const n=wh(e);for(const e of t.elements)n.some((t=>pu(t,e)))||n.push(e);return{arrayValue:{values:n}}}class gh extends ch{constructor(t){super(),this.elements=t}}function mh(t,e){let n=wh(e);for(const e of t.elements)n=n.filter((t=>!pu(t,e)));return{arrayValue:{values:n}}}class yh extends ch{constructor(t,e){super(),this.wt=t,this._t=e}}function vh(t){return iu(t.integerValue||t.doubleValue)}function wh(t){return Eu(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ih{constructor(t,e){this.version=t,this.transformResults=e}}class Eh{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Eh}static exists(t){return new Eh(void 0,t)}static updateTime(t){return new Eh(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function bh(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Th{}function _h(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Ph(t.key,Eh.none()):new Nh(t.key,t.data,Eh.none());{const n=t.data,i=ku.empty();let s=new Jc(xc.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),s=s.add(t)}return new Dh(t.key,i,new Zc(s.toArray()),Eh.none())}}function Sh(t,e,n){t instanceof Nh?function(t,e,n){const i=t.value.clone(),s=Oh(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof Dh?function(t,e,n){if(!bh(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Oh(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Rh(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ch(t,e,n,i){return t instanceof Nh?function(t,e,n,i){if(!bh(t.precondition,e))return n;const s=t.value.clone(),r=Lh(t.fieldTransforms,i,e);return s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,i):t instanceof Dh?function(t,e,n,i){if(!bh(t.precondition,e))return n;const s=Lh(t.fieldTransforms,i,e),r=e.data;return r.setAll(Rh(t)),r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return bh(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function kh(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),s=lh(i.transform,t||null);null!=s&&(null===n&&(n=ku.empty()),n.set(i.field,s))}return n||null}function Ah(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Dc(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof fh&&e instanceof fh||t instanceof gh&&e instanceof gh?Dc(t.elements,e.elements,pu):t instanceof yh&&e instanceof yh?pu(t._t,e._t):t instanceof dh&&e instanceof dh}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Nh extends Th{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Dh extends Th{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Rh(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function Oh(t,e,n){const i=new Map;gc(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,hh(o,a,n[s]))}return i}function Lh(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,uh(t,r,e))}return i}class Ph extends Th{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mh extends Th{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class xh{constructor(t){this.count=t}}var Fh,Uh;function Vh(t){if(void 0===t)return lc("GRPC error has no .code"),yc.UNKNOWN;switch(t){case Fh.OK:return yc.OK;case Fh.CANCELLED:return yc.CANCELLED;case Fh.UNKNOWN:return yc.UNKNOWN;case Fh.DEADLINE_EXCEEDED:return yc.DEADLINE_EXCEEDED;case Fh.RESOURCE_EXHAUSTED:return yc.RESOURCE_EXHAUSTED;case Fh.INTERNAL:return yc.INTERNAL;case Fh.UNAVAILABLE:return yc.UNAVAILABLE;case Fh.UNAUTHENTICATED:return yc.UNAUTHENTICATED;case Fh.INVALID_ARGUMENT:return yc.INVALID_ARGUMENT;case Fh.NOT_FOUND:return yc.NOT_FOUND;case Fh.ALREADY_EXISTS:return yc.ALREADY_EXISTS;case Fh.PERMISSION_DENIED:return yc.PERMISSION_DENIED;case Fh.FAILED_PRECONDITION:return yc.FAILED_PRECONDITION;case Fh.ABORTED:return yc.ABORTED;case Fh.OUT_OF_RANGE:return yc.OUT_OF_RANGE;case Fh.UNIMPLEMENTED:return yc.UNIMPLEMENTED;case Fh.DATA_LOSS:return yc.DATA_LOSS;default:return pc()}}(Uh=Fh||(Fh={}))[Uh.OK=0]="OK",Uh[Uh.CANCELLED=1]="CANCELLED",Uh[Uh.UNKNOWN=2]="UNKNOWN",Uh[Uh.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Uh[Uh.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Uh[Uh.NOT_FOUND=5]="NOT_FOUND",Uh[Uh.ALREADY_EXISTS=6]="ALREADY_EXISTS",Uh[Uh.PERMISSION_DENIED=7]="PERMISSION_DENIED",Uh[Uh.UNAUTHENTICATED=16]="UNAUTHENTICATED",Uh[Uh.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Uh[Uh.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Uh[Uh.ABORTED=10]="ABORTED",Uh[Uh.OUT_OF_RANGE=11]="OUT_OF_RANGE",Uh[Uh.UNIMPLEMENTED=12]="UNIMPLEMENTED",Uh[Uh.INTERNAL=13]="INTERNAL",Uh[Uh.UNAVAILABLE=14]="UNAVAILABLE",Uh[Uh.DATA_LOSS=15]="DATA_LOSS";class jh{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Hc(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return Gc(this.inner)}size(){return this.innerSize}}const Bh=new Wc(Fc.comparator);function qh(){return Bh}const $h=new Wc(Fc.comparator);function zh(...t){let e=$h;for(const n of t)e=e.insert(n.key,n);return e}function Kh(t){let e=$h;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Hh(){return Wh()}function Gh(){return Wh()}function Wh(){return new jh((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Qh=new Wc(Fc.comparator),Xh=new Jc(Fc.comparator);function Jh(...t){let e=Xh;for(const n of t)e=e.add(n);return e}const Yh=new Jc(Nc);function Zh(){return Yh}class tl{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,el.createSynthesizedTargetChangeForCurrentChange(t,e)),new tl(Oc.min(),n,Zh(),qh(),Jh())}}class el{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new el(tu.EMPTY_BYTE_STRING,e,Jh(),Jh(),Jh())}}class nl{constructor(t,e,n,i){this.gt=t,this.removedTargetIds=e,this.key=n,this.yt=i}}class il{constructor(t,e){this.targetId=t,this.It=e}}class sl{constructor(t,e,n=tu.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class rl{constructor(){this.Tt=0,this.Et=cl(),this.At=tu.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(t){t.approximateByteSize()>0&&(this.bt=!0,this.At=t)}St(){let t=Jh(),e=Jh(),n=Jh();return this.Et.forEach(((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:pc()}})),new el(this.At,this.Rt,t,e,n)}Dt(){this.bt=!1,this.Et=cl()}Ct(t,e){this.bt=!0,this.Et=this.Et.insert(t,e)}xt(t){this.bt=!0,this.Et=this.Et.remove(t)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class ol{constructor(t){this.Mt=t,this.Ft=new Map,this.$t=qh(),this.Bt=al(),this.Lt=new Jc(Nc)}Ut(t){for(const e of t.gt)t.yt&&t.yt.isFoundDocument()?this.qt(e,t.yt):this.Kt(e,t.key,t.yt);for(const e of t.removedTargetIds)this.Kt(e,t.key,t.yt)}Gt(t){this.forEachTarget(t,(e=>{const n=this.Qt(e);switch(t.state){case 0:this.jt(e)&&n.Vt(t.resumeToken);break;case 1:n.kt(),n.Pt||n.Dt(),n.Vt(t.resumeToken);break;case 2:n.kt(),n.Pt||this.removeTarget(e);break;case 3:this.jt(e)&&(n.Ot(),n.Vt(t.resumeToken));break;case 4:this.jt(e)&&(this.Wt(e),n.Vt(t.resumeToken));break;default:pc()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ft.forEach(((t,n)=>{this.jt(n)&&e(n)}))}zt(t){const e=t.targetId,n=t.It.count,i=this.Ht(e);if(i){const t=i.target;if(Pu(t))if(0===n){const n=new Fc(t.path);this.Kt(e,n,Nu.newNoDocument(n,Oc.min()))}else gc(1===n);else this.Jt(e)!==n&&(this.Wt(e),this.Lt=this.Lt.add(e))}}Yt(t){const e=new Map;this.Ft.forEach(((n,i)=>{const s=this.Ht(i);if(s){if(n.current&&Pu(s.target)){const e=new Fc(s.target.path);null!==this.$t.get(e)||this.Xt(i,e)||this.Kt(i,e,Nu.newNoDocument(e,t))}n.vt&&(e.set(i,n.St()),n.Dt())}}));let n=Jh();this.Bt.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.Ht(t);return!e||2===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.$t.forEach(((e,n)=>n.setReadTime(t)));const i=new tl(t,e,this.Lt,this.$t,n);return this.$t=qh(),this.Bt=al(),this.Lt=new Jc(Nc),i}qt(t,e){if(!this.jt(t))return;const n=this.Xt(t,e.key)?2:0;this.Qt(t).Ct(e.key,n),this.$t=this.$t.insert(e.key,e),this.Bt=this.Bt.insert(e.key,this.Zt(e.key).add(t))}Kt(t,e,n){if(!this.jt(t))return;const i=this.Qt(t);this.Xt(t,e)?i.Ct(e,1):i.xt(e),this.Bt=this.Bt.insert(e,this.Zt(e).delete(t)),n&&(this.$t=this.$t.insert(e,n))}removeTarget(t){this.Ft.delete(t)}Jt(t){const e=this.Qt(t).St();return this.Mt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Nt(t){this.Qt(t).Nt()}Qt(t){let e=this.Ft.get(t);return e||(e=new rl,this.Ft.set(t,e)),e}Zt(t){let e=this.Bt.get(t);return e||(e=new Jc(Nc),this.Bt=this.Bt.insert(t,e)),e}jt(t){const e=null!==this.Ht(t);return e||hc("WatchChangeAggregator","Detected inactive target",t),e}Ht(t){const e=this.Ft.get(t);return e&&e.Pt?null:this.Mt.te(t)}Wt(t){this.Ft.set(t,new rl),this.Mt.getRemoteKeysForTarget(t).forEach((e=>{this.Kt(t,e,null)}))}Xt(t,e){return this.Mt.getRemoteKeysForTarget(t).has(e)}}function al(){return new Wc(Fc.comparator)}function cl(){return new Wc(Fc.comparator)}const ul={asc:"ASCENDING",desc:"DESCENDING"},hl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ll{constructor(t,e){this.databaseId=t,this.dt=e}}function dl(t,e){return t.dt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function fl(t,e){return t.dt?e.toBase64():e.toUint8Array()}function pl(t,e){return dl(t,e.toTimestamp())}function gl(t){return gc(!!t),Oc.fromTimestamp(function(t){const e=nu(t);return new Rc(e.seconds,e.nanos)}(t))}function ml(t,e){return function(t){return new Pc(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function yl(t){const e=Pc.fromString(t);return gc(Ml(e)),e}function vl(t,e){return ml(t.databaseId,e.path)}function wl(t,e){const n=yl(e);if(n.get(1)!==t.databaseId.projectId)throw new vc(yc.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new vc(yc.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Fc(bl(n))}function Il(t,e){return ml(t.databaseId,e)}function El(t){return new Pc(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function bl(t){return gc(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Tl(t,e,n){return{name:vl(t,e),fields:n.value.mapValue.fields}}function _l(t,e){return{documents:[Il(t,e.path)]}}function Sl(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=Il(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Il(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Tu(t.value))return{unaryFilter:{field:Dl(t.field),op:"IS_NAN"}};if(bu(t.value))return{unaryFilter:{field:Dl(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Tu(t.value))return{unaryFilter:{field:Dl(t.field),op:"IS_NOT_NAN"}};if(bu(t.value))return{unaryFilter:{field:Dl(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dl(t.field),op:Nl(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Dl(t.field),direction:Al(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.dt||hu(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Cl(t){let e=function(t){const e=yl(t);return 4===e.length?Pc.emptyPath():bl(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){gc(1===i);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=kl(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Ku(Rl(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,hu(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new zu(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new zu(n,e)}(n.endAt)),function(t,e,n,i,s,r,o,a){return new Qu(t,e,n,i,s,r,o,a)}(e,s,o,r,a,"F",c,u)}function kl(t){return t?void 0!==t.unaryFilter?[Ll(t)]:void 0!==t.fieldFilter?[Ol(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>kl(t))).reduce(((t,e)=>t.concat(e))):pc():[]}function Al(t){return ul[t]}function Nl(t){return hl[t]}function Dl(t){return{fieldPath:t.canonicalString()}}function Rl(t){return xc.fromServerFormat(t.fieldPath)}function Ol(t){return Mu.create(Rl(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return pc()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ll(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Rl(t.unaryFilter.field);return Mu.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Rl(t.unaryFilter.field);return Mu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Rl(t.unaryFilter.field);return Mu.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Rl(t.unaryFilter.field);return Mu.create(s,"!=",{nullValue:"NULL_VALUE"});default:return pc()}}function Pl(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Ml(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class xl{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&Sh(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ch(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ch(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Gh();return this.mutations.forEach((i=>{const s=t.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=e.has(i.key)?null:o;const a=_h(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(Oc.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Jh())}isEqual(t){return this.batchId===t.batchId&&Dc(this.mutations,t.mutations,((t,e)=>Ah(t,e)))&&Dc(this.baseMutations,t.baseMutations,((t,e)=>Ah(t,e)))}}class Fl{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){gc(t.mutations.length===n.length);let i=Qh;const s=t.mutations;for(let t=0;t<s.length;t++)i=i.insert(s[t].key,n[t].version);return new Fl(t,e,n,i)}}class Ul{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Vl{constructor(t,e,n,i,s=Oc.min(),r=Oc.min(),o=tu.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Vl(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Vl(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Vl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class jl{constructor(t){this.ne=t}}function Bl(t){const e=Cl({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?function(t,e,n){return new Qu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(e,e.limit,"L"):e}class ql{constructor(){}re(t,e){this.oe(t,e),e.ue()}oe(t,e){if("nullValue"in t)this.ce(e,5);else if("booleanValue"in t)this.ce(e,10),e.ae(t.booleanValue?1:0);else if("integerValue"in t)this.ce(e,15),e.ae(iu(t.integerValue));else if("doubleValue"in t){const n=iu(t.doubleValue);isNaN(n)?this.ce(e,13):(this.ce(e,15),lu(n)?e.ae(0):e.ae(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ce(e,20),"string"==typeof n?e.he(n):(e.he(`${n.seconds||""}`),e.ae(n.nanos||0))}else if("stringValue"in t)this.le(t.stringValue,e),this.fe(e);else if("bytesValue"in t)this.ce(e,30),e.de(su(t.bytesValue)),this.fe(e);else if("referenceValue"in t)this._e(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ce(e,45),e.ae(n.latitude||0),e.ae(n.longitude||0)}else"mapValue"in t?Cu(t)?this.ce(e,Number.MAX_SAFE_INTEGER):(this.we(t.mapValue,e),this.fe(e)):"arrayValue"in t?(this.me(t.arrayValue,e),this.fe(e)):pc()}le(t,e){this.ce(e,25),this.ge(t,e)}ge(t,e){e.he(t)}we(t,e){const n=t.fields||{};this.ce(e,55);for(const t of Object.keys(n))this.le(t,e),this.oe(n[t],e)}me(t,e){const n=t.values||[];this.ce(e,50);for(const t of n)this.oe(t,e)}_e(t,e){this.ce(e,37),Fc.fromName(t).path.forEach((t=>{this.ce(e,60),this.ge(t,e)}))}ce(t,e){t.ae(e)}fe(t){t.ae(2)}}ql.ye=new ql;class $l{constructor(){this.ze=new zl}addToCollectionParentIndex(t,e){return this.ze.add(e),qc.resolve()}getCollectionParents(t,e){return qc.resolve(this.ze.getEntries(e))}addFieldIndex(t,e){return qc.resolve()}deleteFieldIndex(t,e){return qc.resolve()}getDocumentsMatchingTarget(t,e){return qc.resolve(null)}getIndexType(t,e){return qc.resolve(0)}getFieldIndexes(t,e){return qc.resolve([])}getNextCollectionGroupToUpdate(t){return qc.resolve(null)}getMinOffset(t,e){return qc.resolve(Vc.min())}getMinOffsetFromCollectionGroup(t,e){return qc.resolve(Vc.min())}updateCollectionGroup(t,e,n){return qc.resolve()}updateIndexEntries(t,e){return qc.resolve()}}class zl{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Jc(Pc.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Jc(Pc.comparator)).toArray()}}new Uint8Array(0);class Kl{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Kl(t,Kl.DEFAULT_COLLECTION_PERCENTILE,Kl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Kl.DEFAULT_COLLECTION_PERCENTILE=10,Kl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Kl.DEFAULT=new Kl(41943040,Kl.DEFAULT_COLLECTION_PERCENTILE,Kl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Kl.DISABLED=new Kl(-1,0,0);class Hl{constructor(t){this.En=t}next(){return this.En+=2,this.En}static An(){return new Hl(0)}static Rn(){return new Hl(-1)}}class Gl{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Wl{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.getBaseDocument(t,e,n)))).next((t=>(null!==n&&Ch(n.mutation,t,Zc.empty(),Rc.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Jh()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Jh()){const i=Hh();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=zh();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Hh();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Jh())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let s=qh();const r=Wh(),o=Wh();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof Dh)?s=s.insert(e.key,e):void 0!==o&&(r.set(e.key,o.mutation.getFieldMask()),Ch(o.mutation,e,o.mutation.getFieldMask(),Rc.now()))})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Gl(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Wh();let i=new Wc(((t,e)=>t-e)),s=Jh();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||Zc.empty();o=s.applyToLocalView(r,o),n.set(t,o);const a=(i.get(s.batchId)||Jh()).add(t);i=i.insert(s.batchId,a)}))})).next((()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=Gh();c.forEach((t=>{if(!s.has(t)){const i=_h(e.get(t),n.get(t));null!==i&&u.set(t,i),s=s.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,u))}return qc.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return Fc.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):qc.resolve(Hh());let o=-1,a=s;return r.next((e=>qc.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?qc.resolve():this.getBaseDocument(t,e,n).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,Jh()))).next((t=>({batchId:o,changes:Kh(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Fc(e)).next((t=>{let e=zh();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let s=zh();return this.indexManager.getCollectionParents(t,i).next((r=>qc.forEach(r,(r=>{const o=function(t,e){return new Qu(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next((s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)))).next((t=>{t.forEach(((t,e)=>{const n=e.getKey();null===i.get(n)&&(i=i.insert(n,Nu.newInvalidDocument(n)))}));let n=zh();return i.forEach(((i,s)=>{const r=t.get(i);void 0!==r&&Ch(r.mutation,s,Zc.empty(),Rc.now()),nh(e,s)&&(n=n.insert(i,s))})),n}))}getBaseDocument(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):qc.resolve(Nu.newInvalidDocument(e))}}class Ql{constructor(t){this.wt=t,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(t,e){return qc.resolve(this.Jn.get(e))}saveBundleMetadata(t,e){var n;return this.Jn.set(e.id,{id:(n=e).id,version:n.version,createTime:gl(n.createTime)}),qc.resolve()}getNamedQuery(t,e){return qc.resolve(this.Yn.get(e))}saveNamedQuery(t,e){return this.Yn.set(e.name,function(t){return{name:t.name,query:Bl(t.bundledQuery),readTime:gl(t.readTime)}}(e)),qc.resolve()}}class Xl{constructor(){this.overlays=new Wc(Fc.comparator),this.Xn=new Map}getOverlay(t,e){return qc.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Hh();return qc.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.ie(t,e,i)})),qc.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.Xn.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.Xn.delete(n)),qc.resolve()}getOverlaysForCollection(t,e,n){const i=Hh(),s=e.length+1,r=new Fc(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===s&&t.largestBatchId>n&&i.set(t.getKey(),t)}return qc.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new Wc(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Hh(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Hh(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return qc.resolve(o)}ie(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.Xn.get(i.largestBatchId).delete(n.key);this.Xn.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ul(e,n));let s=this.Xn.get(e);void 0===s&&(s=Jh(),this.Xn.set(e,s)),this.Xn.set(e,s.add(n.key))}}class Jl{constructor(){this.Zn=new Jc(Yl.ts),this.es=new Jc(Yl.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const n=new Yl(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.rs(new Yl(t,e))}os(t,e){t.forEach((t=>this.removeReference(t,e)))}us(t){const e=new Fc(new Pc([])),n=new Yl(e,t),i=new Yl(e,t+1),s=[];return this.es.forEachInRange([n,i],(t=>{this.rs(t),s.push(t.key)})),s}cs(){this.Zn.forEach((t=>this.rs(t)))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new Fc(new Pc([])),n=new Yl(e,t),i=new Yl(e,t+1);let s=Jh();return this.es.forEachInRange([n,i],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Yl(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Yl{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return Fc.comparator(t.key,e.key)||Nc(t.ls,e.ls)}static ns(t,e){return Nc(t.ls,e.ls)||Fc.comparator(t.key,e.key)}}class Zl{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.fs=1,this.ds=new Jc(Yl.ts)}checkEmpty(t){return qc.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const s=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new xl(s,e,n,i);this.mutationQueue.push(r);for(const e of i)this.ds=this.ds.add(new Yl(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return qc.resolve(r)}lookupMutationBatch(t,e){return qc.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.ws(n),s=i<0?0:i;return qc.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return qc.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(t){return qc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Yl(e,0),i=new Yl(e,Number.POSITIVE_INFINITY),s=[];return this.ds.forEachInRange([n,i],(t=>{const e=this._s(t.ls);s.push(e)})),qc.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Jc(Nc);return e.forEach((t=>{const e=new Yl(t,0),i=new Yl(t,Number.POSITIVE_INFINITY);this.ds.forEachInRange([e,i],(t=>{n=n.add(t.ls)}))})),qc.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;Fc.isDocumentKey(s)||(s=s.child(""));const r=new Yl(new Fc(s),0);let o=new Jc(Nc);return this.ds.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.ls)),!0)}),r),qc.resolve(this.gs(o))}gs(t){const e=[];return t.forEach((t=>{const n=this._s(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){gc(0===this.ys(e.batchId,"removed")),this.mutationQueue.shift();let n=this.ds;return qc.forEach(e.mutations,(i=>{const s=new Yl(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.ds=n}))}In(t){}containsKey(t,e){const n=new Yl(e,0),i=this.ds.firstAfterOrEqual(n);return qc.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,qc.resolve()}ys(t,e){return this.ws(t)}ws(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}_s(t){const e=this.ws(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class td{constructor(t){this.ps=t,this.docs=new Wc(Fc.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,r=this.ps(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return qc.resolve(n?n.document.mutableCopy():Nu.newInvalidDocument(e))}getEntries(t,e){let n=qh();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Nu.newInvalidDocument(t))})),qc.resolve(n)}getAllFromCollection(t,e,n){let i=qh();const s=new Fc(e.child("")),r=this.docs.getIteratorFrom(s);for(;r.hasNext();){const{key:t,value:{document:s}}=r.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||jc(Uc(s),n)<=0||(i=i.insert(s.key,s.mutableCopy()))}return qc.resolve(i)}getAllFromCollectionGroup(t,e,n,i){pc()}Is(t,e){return qc.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ed(this)}getSize(t){return qc.resolve(this.size)}}class ed extends class{constructor(){this.changes=new jh((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Nu.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?qc.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}{constructor(t){super(),this.zn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.zn.addEntry(t,i)):this.zn.removeEntry(n)})),qc.waitFor(e)}getFromCache(t,e){return this.zn.getEntry(t,e)}getAllFromCache(t,e){return this.zn.getEntries(t,e)}}class nd{constructor(t){this.persistence=t,this.Ts=new jh((t=>Ou(t)),Lu),this.lastRemoteSnapshotVersion=Oc.min(),this.highestTargetId=0,this.Es=0,this.As=new Jl,this.targetCount=0,this.Rs=Hl.An()}forEachTarget(t,e){return this.Ts.forEach(((t,n)=>e(n))),qc.resolve()}getLastRemoteSnapshotVersion(t){return qc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return qc.resolve(this.Es)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),qc.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Es&&(this.Es=e),qc.resolve()}vn(t){this.Ts.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new Hl(e),this.highestTargetId=e),t.sequenceNumber>this.Es&&(this.Es=t.sequenceNumber)}addTargetData(t,e){return this.vn(e),this.targetCount+=1,qc.resolve()}updateTargetData(t,e){return this.vn(e),qc.resolve()}removeTargetData(t,e){return this.Ts.delete(e.target),this.As.us(e.targetId),this.targetCount-=1,qc.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.Ts.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Ts.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),qc.waitFor(s).next((()=>i))}getTargetCount(t){return qc.resolve(this.targetCount)}getTargetData(t,e){const n=this.Ts.get(e)||null;return qc.resolve(n)}addMatchingKeys(t,e,n){return this.As.ss(e,n),qc.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach((e=>{s.push(i.markPotentiallyOrphaned(t,e))})),qc.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.As.us(e),qc.resolve()}getMatchingKeysForTargetId(t,e){const n=this.As.hs(e);return qc.resolve(n)}containsKey(t,e){return qc.resolve(this.As.containsKey(e))}}class id{constructor(t,e){this.bs={},this.overlays={},this.Ps=new zc(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new nd(this),this.indexManager=new $l,this.remoteDocumentCache=function(t){return new td(t)}((t=>this.referenceDelegate.Ss(t))),this.wt=new jl(e),this.Ds=new Ql(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Xl,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.bs[t.toKey()];return n||(n=new Zl(e,this.referenceDelegate),this.bs[t.toKey()]=n),n}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(t,e,n){hc("MemoryPersistence","Starting transaction:",t);const i=new sd(this.Ps.next());return this.referenceDelegate.Cs(),n(i).next((t=>this.referenceDelegate.xs(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Ns(t,e){return qc.or(Object.values(this.bs).map((n=>()=>n.containsKey(t,e))))}}class sd extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}{constructor(t){super(),this.currentSequenceNumber=t}}class rd{constructor(t){this.persistence=t,this.ks=new Jl,this.Os=null}static Ms(t){return new rd(t)}get Fs(){if(this.Os)return this.Os;throw pc()}addReference(t,e,n){return this.ks.addReference(n,e),this.Fs.delete(n.toString()),qc.resolve()}removeReference(t,e,n){return this.ks.removeReference(n,e),this.Fs.add(n.toString()),qc.resolve()}markPotentiallyOrphaned(t,e){return this.Fs.add(e.toString()),qc.resolve()}removeTarget(t,e){this.ks.us(e.targetId).forEach((t=>this.Fs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Fs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Cs(){this.Os=new Set}xs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return qc.forEach(this.Fs,(n=>{const i=Fc.fromPath(n);return this.$s(t,i).next((t=>{t||e.removeEntry(i,Oc.min())}))})).next((()=>(this.Os=null,e.apply(t))))}updateLimboDocument(t,e){return this.$s(t,e).next((t=>{t?this.Fs.delete(e.toString()):this.Fs.add(e.toString())}))}Ss(t){return 0}$s(t,e){return qc.or([()=>qc.resolve(this.ks.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ns(t,e)])}}class od{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Pi=n,this.vi=i}static Vi(t,e){let n=Jh(),i=Jh();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new od(t,e.fromCache,n,i)}}class ad{constructor(){this.Si=!1}initialize(t,e){this.Di=t,this.indexManager=e,this.Si=!0}getDocumentsMatchingQuery(t,e,n,i){return this.Ci(t,e).next((s=>s||this.xi(t,e,i,n))).next((n=>n||this.Ni(t,e)))}Ci(t,e){return qc.resolve(null)}xi(t,e,n,i){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||i.isEqual(Oc.min())?this.Ni(t,e):this.Di.getDocuments(t,n).next((s=>{const r=this.ki(e,s);return this.Oi(e,r,n,i)?this.Ni(t,e):(uc()<=N.DEBUG&&hc("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),eh(e)),this.Mi(t,r,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=Oc.fromTimestamp(1e9===i?new Rc(n+1,0):new Rc(n,i));return new Vc(s,Fc.empty(),e)}(i,-1)))}))}ki(t,e){let n=new Jc(ih(t));return e.forEach(((e,i)=>{nh(t,i)&&(n=n.add(i))})),n}Oi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ni(t,e){return uc()<=N.DEBUG&&hc("QueryEngine","Using full collection scan to execute query:",eh(e)),this.Di.getDocumentsMatchingQuery(t,e,Vc.min())}Mi(t,e,n,i){return this.Di.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class cd{constructor(t,e,n,i){this.persistence=t,this.Fi=e,this.wt=i,this.$i=new Wc(Nc),this.Bi=new jh((t=>Ou(t)),Lu),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(n)}qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Wl(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.$i)))}}async function ud(t,e){const n=mc(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((s=>(i=s,n.qi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],r=[];let o=Jh();for(const t of i){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Ki:t,removedBatchIds:s,addedBatchIds:r})))}))}))}function hd(t){const e=mc(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Vs.getLastRemoteSnapshotVersion(t)))}function ld(t,e){const n=mc(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function dd(t,e,n){const i=mc(t),s=i.$i.get(e),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(t=>i.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!$c(t))throw t;hc("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.$i=i.$i.remove(e),i.Bi.delete(s.target)}function fd(t,e,n){const i=mc(t);let s=Oc.min(),r=Jh();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=mc(t),s=i.Bi.get(n);return void 0!==s?qc.resolve(i.$i.get(s)):i.Vs.getTargetData(e,n)}(i,t,Yu(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Vs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>i.Fi.getDocumentsMatchingQuery(t,e,n?s:Oc.min(),n?r:Jh()))).next((t=>(function(t,e,n){let i=Oc.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.Li.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ji:r})))))}class pd{constructor(){this.activeTargetIds=Zh()}Xi(t){this.activeTargetIds=this.activeTargetIds.add(t)}Zi(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Yi(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class gd{constructor(){this.Fr=new pd,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Fr.Xi(t),this.$r[t]||"not-current"}updateQueryState(t,e,n){this.$r[t]=e}removeLocalQueryTarget(t){this.Fr.Zi(t)}isLocalQueryTarget(t){return this.Fr.activeTargetIds.has(t)}clearQueryState(t){delete this.$r[t]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(t){return this.Fr.activeTargetIds.has(t)}start(){return this.Fr=new pd,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class md{Br(t){}shutdown(){}}class yd{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(t){this.Gr.push(t)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){hc("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Gr)t(0)}Kr(){hc("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Gr)t(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const vd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class wd{constructor(t){this.jr=t.jr,this.Wr=t.Wr}zr(t){this.Hr=t}Jr(t){this.Yr=t}onMessage(t){this.Xr=t}close(){this.Wr()}send(t){this.jr(t)}Zr(){this.Hr()}eo(t){this.Yr(t)}no(t){this.Xr(t)}}class Id extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.so=e+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(t,e,n,i,s){const r=this.oo(t,e);hc("RestConnection","Sending: ",r,n);const o={};return this.uo(o,i,s),this.co(t,r,o,n).then((t=>(hc("RestConnection","Received: ",t),t)),(e=>{throw dc("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}ao(t,e,n,i,s,r){return this.ro(t,e,n,i,s)}uo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+ac,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}oo(t,e){const n=vd[t];return`${this.so}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}co(t,e,n,i){return new Promise(((s,r)=>{const o=new sc;o.listenOnce(Za.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Ya.NO_ERROR:const e=o.getResponseJson();hc("Connection","XHR received:",JSON.stringify(e)),s(e);break;case Ya.TIMEOUT:hc("Connection",'RPC "'+t+'" timed out'),r(new vc(yc.DEADLINE_EXCEEDED,"Request time out"));break;case Ya.HTTP_ERROR:const n=o.getStatus();if(hc("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(yc).indexOf(e)>=0?e:yc.UNKNOWN}(t.status);r(new vc(e,t.message))}else r(new vc(yc.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new vc(yc.UNAVAILABLE,"Connection failed."));break;default:pc()}}finally{hc("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(i);o.send(e,"POST",a,n,15)}))}ho(t,e,n){const i=[this.so,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Xa(),h=Ja(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(l.xmlHttpFactory=new nc({})),this.uo(l.initMessageHeaders,e,n),o()||c()||r().indexOf("Electron/")>=0||u()||r().indexOf("MSAppHost/")>=0||a()||(l.httpHeadersOverwriteParam="$httpHeaders");const d=i.join("");hc("Connection","Creating WebChannel: "+d,l);const f=s.createWebChannel(d,l);let p=!1,g=!1;const m=new wd({jr:t=>{g?hc("Connection","Not sending because WebChannel is closed:",t):(p||(hc("Connection","Opening WebChannel transport."),f.open(),p=!0),hc("Connection","WebChannel sending:",t),f.send(t))},Wr:()=>f.close()}),y=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return y(f,ic.EventType.OPEN,(()=>{g||hc("Connection","WebChannel transport opened.")})),y(f,ic.EventType.CLOSE,(()=>{g||(g=!0,hc("Connection","WebChannel transport closed"),m.eo())})),y(f,ic.EventType.ERROR,(t=>{g||(g=!0,dc("Connection","WebChannel transport errored:",t),m.eo(new vc(yc.UNAVAILABLE,"The operation could not be completed")))})),y(f,ic.EventType.MESSAGE,(t=>{var e;if(!g){const n=t.data[0];gc(!!n);const i=n,s=i.error||(null===(e=i[0])||void 0===e?void 0:e.error);if(s){hc("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=Fh[t];if(void 0!==e)return Vh(e)}(t),n=s.message;void 0===e&&(e=yc.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),g=!0,m.eo(new vc(e,n)),f.close()}else hc("Connection","WebChannel received:",n),m.no(n)}})),y(h,tc.STAT_EVENT,(t=>{t.stat===ec.PROXY?hc("Connection","Detected buffering proxy"):t.stat===ec.NOPROXY&&hc("Connection","Detected no buffering proxy")})),setTimeout((()=>{m.Zr()}),0),m}}function Ed(){return"undefined"!=typeof document?document:null}function bd(t){return new ll(t,!0)}class Td{constructor(t,e,n=1e3,i=1.5,s=6e4){this.js=t,this.timerId=e,this.lo=n,this.fo=i,this._o=s,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(t){this.cancel();const e=Math.floor(this.wo+this.To()),n=Math.max(0,Date.now()-this.yo),i=Math.max(0,e-n);i>0&&hc("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.wo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,i,(()=>(this.yo=Date.now(),t()))),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class _d{constructor(t,e,n,i,s,r,o,a){this.js=t,this.Ao=n,this.Ro=i,this.bo=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Td(t,e)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}async stop(){this.Do()&&await this.close(0)}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,(()=>this.Oo())))}Mo(t){this.Fo(),this.stream.send(t)}async Oo(){if(this.Co())return this.close(0)}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}async close(t,e){this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==t?this.So.reset():e&&e.code===yc.RESOURCE_EXHAUSTED?(lc(e.toString()),lc("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):e&&e.code===yc.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Jr(e)}Bo(){}auth(){this.state=1;const t=this.Lo(this.Po),e=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Po===e&&this.Uo(t,n)}),(e=>{t((()=>{const t=new vc(yc.UNKNOWN,"Fetching auth token failed: "+e.message);return this.qo(t)}))}))}Uo(t,e){const n=this.Lo(this.Po);this.stream=this.Ko(t,e),this.stream.zr((()=>{n((()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,(()=>(this.Co()&&(this.state=3),Promise.resolve()))),this.listener.zr())))})),this.stream.Jr((t=>{n((()=>this.qo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}xo(){this.state=5,this.So.Io((async()=>{this.state=0,this.start()}))}qo(t){return hc("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Lo(t){return e=>{this.js.enqueueAndForget((()=>this.Po===t?e():(hc("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Sd extends _d{constructor(t,e,n,i,s,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,r),this.wt=s}Ko(t,e){return this.bo.ho("Listen",t,e)}onMessage(t){this.So.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:pc()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(t,e){return t.dt?(gc(void 0===e||"string"==typeof e),tu.fromBase64String(e||"")):(gc(void 0===e||e instanceof Uint8Array),tu.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?yc.UNKNOWN:Vh(t.code);return new vc(e,t.message||"")}(o);n=new sl(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=wl(t,i.document.name),r=gl(i.document.updateTime),o=new ku({mapValue:{fields:i.document.fields}}),a=Nu.newFoundDocument(s,r,o),c=i.targetIds||[],u=i.removedTargetIds||[];n=new nl(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=wl(t,i.document),r=i.readTime?gl(i.readTime):Oc.min(),o=Nu.newNoDocument(s,r),a=i.removedTargetIds||[];n=new nl([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=wl(t,i.document),r=i.removedTargetIds||[];n=new nl([],r,s,null)}else{if(!("filter"in e))return pc();{e.filter;const t=e.filter;t.targetId;const i=t.count||0,s=new xh(i),r=t.targetId;n=new il(r,s)}}return n}(this.wt,t),n=function(t){if(!("targetChange"in t))return Oc.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Oc.min():e.readTime?gl(e.readTime):Oc.min()}(t);return this.listener.Go(e,n)}Qo(t){const e={};e.database=El(this.wt),e.addTarget=function(t,e){let n;const i=e.target;return n=Pu(i)?{documents:_l(t,i)}:{query:Sl(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=fl(t,e.resumeToken):e.snapshotVersion.compareTo(Oc.min())>0&&(n.readTime=dl(t,e.snapshotVersion.toTimestamp())),n}(this.wt,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return pc()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.wt,t);n&&(e.labels=n),this.Mo(e)}jo(t){const e={};e.database=El(this.wt),e.removeTarget=t,this.Mo(e)}}class Cd extends _d{constructor(t,e,n,i,s,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,r),this.wt=s,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(t,e){return this.bo.ho("Write",t,e)}onMessage(t){if(gc(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Wo){this.So.reset();const e=function(t,e){return t&&t.length>0?(gc(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?gl(t.updateTime):gl(e);return n.isEqual(Oc.min())&&(n=gl(e)),new Ih(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=gl(t.commitTime);return this.listener.Jo(n,e)}return gc(!t.writeResults||0===t.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const t={};t.database=El(this.wt),this.Mo(t)}Ho(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Nh)n={update:Tl(t,e.key,e.value)};else if(e instanceof Ph)n={delete:vl(t,e.key)};else if(e instanceof Dh)n={update:Tl(t,e.key,e.data),updateMask:Pl(e.fieldMask)};else{if(!(e instanceof Mh))return pc();n={verify:vl(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof dh)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof fh)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof gh)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof yh)return{fieldPath:e.field.canonicalString(),increment:n._t};throw pc()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:pl(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:pc()}(t,e.precondition)),n}(this.wt,t)))};this.Mo(e)}}class kd extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.bo=n,this.wt=i,this.Zo=!1}tu(){if(this.Zo)throw new vc(yc.FAILED_PRECONDITION,"The client has already been terminated.")}ro(t,e,n){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.bo.ro(t,e,n,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===yc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new vc(yc.UNKNOWN,t.toString())}))}ao(t,e,n,i){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.bo.ao(t,e,n,s,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===yc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new vc(yc.UNKNOWN,t.toString())}))}terminate(){this.Zo=!0}}class Ad{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve()))))}uu(t){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ru("Offline")))}set(t){this.cu(),this.eu=0,"Online"===t&&(this.su=!1),this.ru(t)}ru(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ou(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(lc(e),this.su=!1):hc("OnlineStateTracker",e)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class Nd{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=s,this.du.Br((t=>{n.enqueueAndForget((async()=>{Ud(this)&&(hc("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=mc(t);e.lu.add(4),await Rd(e),e._u.set("Unknown"),e.lu.delete(4),await Dd(e)}(this))}))})),this._u=new Ad(n,i)}}async function Dd(t){if(Ud(t))for(const e of t.fu)await e(!0)}async function Rd(t){for(const e of t.fu)await e(!1)}function Od(t,e){const n=mc(t);n.hu.has(e.targetId)||(n.hu.set(e.targetId,e),Fd(n)?xd(n):ef(n).Co()&&Pd(n,e))}function Ld(t,e){const n=mc(t),i=ef(n);n.hu.delete(e),i.Co()&&Md(n,e),0===n.hu.size&&(i.Co()?i.ko():Ud(n)&&n._u.set("Unknown"))}function Pd(t,e){t.wu.Nt(e.targetId),ef(t).Qo(e)}function Md(t,e){t.wu.Nt(e),ef(t).jo(e)}function xd(t){t.wu=new ol({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),te:e=>t.hu.get(e)||null}),ef(t).start(),t._u.iu()}function Fd(t){return Ud(t)&&!ef(t).Do()&&t.hu.size>0}function Ud(t){return 0===mc(t).lu.size}function Vd(t){t.wu=void 0}async function jd(t){t.hu.forEach(((e,n)=>{Pd(t,e)}))}async function Bd(t,e){Vd(t),Fd(t)?(t._u.uu(e),xd(t)):t._u.set("Unknown")}async function qd(t,e,n){if(t._u.set("Online"),e instanceof sl&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.hu.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.hu.delete(i),t.wu.removeTarget(i))}(t,e)}catch(n){hc("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await $d(t,n)}else if(e instanceof nl?t.wu.Ut(e):e instanceof il?t.wu.zt(e):t.wu.Gt(e),!n.isEqual(Oc.min()))try{const e=await hd(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.wu.Yt(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.hu.get(i);s&&t.hu.set(i,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.hu.get(e);if(!n)return;t.hu.set(e,n.withResumeToken(tu.EMPTY_BYTE_STRING,n.snapshotVersion)),Md(t,e);const i=new Vl(n.target,e,1,n.sequenceNumber);Pd(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){hc("RemoteStore","Failed to raise snapshot:",e),await $d(t,e)}}async function $d(t,e,n){if(!$c(e))throw e;t.lu.add(1),await Rd(t),t._u.set("Offline"),n||(n=()=>hd(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{hc("RemoteStore","Retrying IndexedDB access"),await n(),t.lu.delete(1),await Dd(t)}))}function zd(t,e){return e().catch((n=>$d(t,n,e)))}async function Kd(t){const e=mc(t),n=nf(e);let i=e.au.length>0?e.au[e.au.length-1].batchId:-1;for(;Hd(e);)try{const t=await ld(e.localStore,i);if(null===t){0===e.au.length&&n.ko();break}i=t.batchId,Gd(e,t)}catch(t){await $d(e,t)}Wd(e)&&Qd(e)}function Hd(t){return Ud(t)&&t.au.length<10}function Gd(t,e){t.au.push(e);const n=nf(t);n.Co()&&n.zo&&n.Ho(e.mutations)}function Wd(t){return Ud(t)&&!nf(t).Do()&&t.au.length>0}function Qd(t){nf(t).start()}async function Xd(t){nf(t).Xo()}async function Jd(t){const e=nf(t);for(const n of t.au)e.Ho(n.mutations)}async function Yd(t,e,n){const i=t.au.shift(),s=Fl.from(i,e,n);await zd(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Kd(t)}async function Zd(t,e){e&&nf(t).zo&&await async function(t,e){if(function(t){switch(t){default:return pc();case yc.CANCELLED:case yc.UNKNOWN:case yc.DEADLINE_EXCEEDED:case yc.RESOURCE_EXHAUSTED:case yc.INTERNAL:case yc.UNAVAILABLE:case yc.UNAUTHENTICATED:return!1;case yc.INVALID_ARGUMENT:case yc.NOT_FOUND:case yc.ALREADY_EXISTS:case yc.PERMISSION_DENIED:case yc.FAILED_PRECONDITION:case yc.ABORTED:case yc.OUT_OF_RANGE:case yc.UNIMPLEMENTED:case yc.DATA_LOSS:return!0}}(n=e.code)&&n!==yc.ABORTED){const n=t.au.shift();nf(t).No(),await zd(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Kd(t)}var n}(t,e),Wd(t)&&Qd(t)}async function tf(t,e){const n=mc(t);n.asyncQueue.verifyOperationInProgress(),hc("RemoteStore","RemoteStore received new credentials");const i=Ud(n);n.lu.add(3),await Rd(n),i&&n._u.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.lu.delete(3),await Dd(n)}function ef(t){return t.mu||(t.mu=function(t,e,n){const i=mc(t);return i.tu(),new Sd(e,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,n)}(t.datastore,t.asyncQueue,{zr:jd.bind(null,t),Jr:Bd.bind(null,t),Go:qd.bind(null,t)}),t.fu.push((async e=>{e?(t.mu.No(),Fd(t)?xd(t):t._u.set("Unknown")):(await t.mu.stop(),Vd(t))}))),t.mu}function nf(t){return t.gu||(t.gu=function(t,e,n){const i=mc(t);return i.tu(),new Cd(e,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,n)}(t.datastore,t.asyncQueue,{zr:Xd.bind(null,t),Jr:Zd.bind(null,t),Yo:Jd.bind(null,t),Jo:Yd.bind(null,t)}),t.fu.push((async e=>{e?(t.gu.No(),await Kd(t)):(await t.gu.stop(),t.au.length>0&&(hc("RemoteStore",`Stopping write stream with ${t.au.length} pending writes`),t.au=[]))}))),t.gu}class sf{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new wc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new sf(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new vc(yc.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function rf(t,e){if(lc("AsyncQueue",`${e}: ${t}`),$c(t))return new vc(yc.UNAVAILABLE,`${e}: ${t}`);throw t}class of{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Fc.comparator(e.key,n.key):(t,e)=>Fc.comparator(t.key,e.key),this.keyedMap=zh(),this.sortedSet=new Wc(this.comparator)}static emptySet(t){return new of(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof of))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new of;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class af{constructor(){this.yu=new Wc(Fc.comparator)}track(t){const e=t.doc.key,n=this.yu.get(e);n?0!==t.type&&3===n.type?this.yu=this.yu.insert(e,t):3===t.type&&1!==n.type?this.yu=this.yu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.yu=this.yu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.yu=this.yu.remove(e):1===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):pc():this.yu=this.yu.insert(e,t)}pu(){const t=[];return this.yu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class cf{constructor(t,e,n,i,s,r,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new cf(t,e,of.emptySet(e),s,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Zu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class uf{constructor(){this.Iu=void 0,this.listeners=[]}}class hf{constructor(){this.queries=new jh((t=>th(t)),Zu),this.onlineState="Unknown",this.Tu=new Set}}function lf(t,e){const n=mc(t);let i=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Au(t)&&(i=!0);s.Iu=t}}i&&ff(n)}function df(t,e,n){const i=mc(t),s=i.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);i.queries.delete(e)}function ff(t){t.Tu.forEach((t=>{t.next()}))}class pf{constructor(t,e,n){this.query=t,this.Ru=e,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=n||{}}Au(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new cf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.bu?this.vu(t)&&(this.Ru.next(t),e=!0):this.Vu(t,this.onlineState)&&(this.Su(t),e=!0),this.Pu=t,e}onError(t){this.Ru.error(t)}Eu(t){this.onlineState=t;let e=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,t)&&(this.Su(this.Pu),e=!0),e}Vu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.Du&&n||t.docs.isEmpty()&&"Offline"!==e)}vu(t){if(t.docChanges.length>0)return!0;const e=this.Pu&&this.Pu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Su(t){t=cf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.bu=!0,this.Ru.next(t)}}class gf{constructor(t){this.key=t}}class mf{constructor(t){this.key=t}}class yf{constructor(t,e){this.query=t,this.Fu=e,this.$u=null,this.current=!1,this.Bu=Jh(),this.mutatedKeys=Jh(),this.Lu=ih(t),this.Uu=new of(this.Lu)}get qu(){return this.Fu}Ku(t,e){const n=e?e.Gu:new af,i=e?e.Uu:this.Uu;let s=e?e.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const u=i.get(t),h=nh(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Qu(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Lu(h,a)>0||c&&this.Lu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(r=r.add(h),s=d?s.add(t):s.delete(t)):(r=r.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Uu:r,Gu:n,Oi:o,mutatedKeys:s}}Qu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.Uu;this.Uu=t.Uu,this.mutatedKeys=t.mutatedKeys;const s=t.Gu.pu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return pc()}};return n(t)-n(e)}(t.type,e.type)||this.Lu(t.doc,e.doc))),this.ju(n);const r=e?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,a=o!==this.$u;return this.$u=o,0!==s.length||a?{snapshot:new cf(this.query,t.Uu,i,s,t.mutatedKeys,0===o,a,!1),zu:r}:{zu:r}}Eu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new af,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(t){return!this.Fu.has(t)&&!!this.Uu.has(t)&&!this.Uu.get(t).hasLocalMutations}ju(t){t&&(t.addedDocuments.forEach((t=>this.Fu=this.Fu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Fu=this.Fu.delete(t))),this.current=t.current)}Wu(){if(!this.current)return[];const t=this.Bu;this.Bu=Jh(),this.Uu.forEach((t=>{this.Hu(t.key)&&(this.Bu=this.Bu.add(t.key))}));const e=[];return t.forEach((t=>{this.Bu.has(t)||e.push(new mf(t))})),this.Bu.forEach((n=>{t.has(n)||e.push(new gf(n))})),e}Ju(t){this.Fu=t.ji,this.Bu=Jh();const e=this.Ku(t.documents);return this.applyChanges(e,!0)}Yu(){return cf.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class vf{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class wf{constructor(t){this.key=t,this.Xu=!1}}class If{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Zu={},this.tc=new jh((t=>th(t)),Zu),this.ec=new Map,this.nc=new Set,this.sc=new Wc(Fc.comparator),this.ic=new Map,this.rc=new Jl,this.oc={},this.uc=new Map,this.cc=Hl.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}async function Ef(t,e){const n=function(t){const e=mc(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Tf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ff.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Sf.bind(null,e),e.Zu.Go=lf.bind(null,e.eventManager),e.Zu.lc=df.bind(null,e.eventManager),e}(t);let i,s;const r=n.tc.get(e);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.Yu();else{const t=await function(t,e){const n=mc(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.Vs.getTargetData(t,e).next((s=>s?(i=s,qc.resolve(i)):n.Vs.allocateTargetId(t).next((s=>(i=new Vl(e,s,0,t.currentSequenceNumber),n.Vs.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.$i.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.$i=n.$i.insert(t.targetId,t),n.Bi.set(e,t.targetId)),t}))}(n.localStore,Yu(e));n.isPrimaryClient&&Od(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,s=await async function(t,e,n,i){t.hc=(e,n,i)=>async function(t,e,n,i){let s=e.view.Ku(n);s.Oi&&(s=await fd(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ku(t,s))));const r=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,r);return Of(t,e.targetId,o.zu),o.snapshot}(t,e,n,i);const s=await fd(t.localStore,e,!0),r=new yf(e,s.ji),o=r.Ku(s.documents),a=el.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState),c=r.applyChanges(o,t.isPrimaryClient,a);Of(t,n,c.zu);const u=new vf(e,n,r);return t.tc.set(e,u),t.ec.has(n)?t.ec.get(n).push(e):t.ec.set(n,[e]),c.snapshot}(n,e,i,"current"===r)}return s}async function bf(t,e){const n=mc(t),i=n.tc.get(e),s=n.ec.get(i.targetId);if(s.length>1)return n.ec.set(i.targetId,s.filter((t=>!Zu(t,e)))),void n.tc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await dd(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Ld(n.remoteStore,i.targetId),Df(n,i.targetId)})).catch(Bc)):(Df(n,i.targetId),await dd(n.localStore,i.targetId,!0))}async function Tf(t,e){const n=mc(t);try{const t=await function(t,e){const n=mc(t),i=e.snapshotVersion;let s=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Ui.newChangeBuffer({trackRemovals:!0});s=n.$i;const o=[];e.targetChanges.forEach(((r,a)=>{const c=s.get(a);if(!c)return;o.push(n.Vs.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.Vs.addMatchingKeys(t,r.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?u=u.withResumeToken(tu.EMPTY_BYTE_STRING,Oc.min()).withLastLimboFreeSnapshotVersion(Oc.min()):r.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(r.resumeToken,i)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,r)&&o.push(n.Vs.updateTargetData(t,u))}));let a=qh(),c=Jh();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=Jh(),s=Jh();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=qh();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(Oc.min())?(e.removeEntry(n,r.readTime),i=i.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),i=i.insert(n,r)):hc("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{Gi:i,Qi:s}}))}(t,r,e.documentUpdates).next((t=>{a=t.Gi,c=t.Qi}))),!i.isEqual(Oc.min())){const e=n.Vs.getLastRemoteSnapshotVersion(t).next((e=>n.Vs.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return qc.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.$i=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.ic.get(e);i&&(gc(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.Xu=!0:t.modifiedDocuments.size>0?gc(i.Xu):t.removedDocuments.size>0&&(gc(i.Xu),i.Xu=!1))})),await Mf(n,t,e)}catch(t){await Bc(t)}}function _f(t,e,n){const i=mc(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.tc.forEach(((n,i)=>{const s=i.view.Eu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=mc(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Eu(e)&&(i=!0)})),i&&ff(n)}(i.eventManager,e),t.length&&i.Zu.Go(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Sf(t,e,n){const i=mc(t);i.sharedClientState.updateQueryState(e,"rejected",n);const s=i.ic.get(e),r=s&&s.key;if(r){let t=new Wc(Fc.comparator);t=t.insert(r,Nu.newNoDocument(r,Oc.min()));const n=Jh().add(r),s=new tl(Oc.min(),new Map,new Jc(Nc),t,n);await Tf(i,s),i.sc=i.sc.remove(r),i.ic.delete(e),Pf(i)}else await dd(i.localStore,e,!1).then((()=>Df(i,e,n))).catch(Bc)}async function Cf(t,e){const n=mc(t),i=e.batch.batchId;try{const t=await function(t,e){const n=mc(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const i=e.batch.keys(),s=n.Ui.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const s=n.batch,r=s.keys();let o=qc.resolve();return r.forEach((t=>{o=o.next((()=>i.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);gc(null!==r),e.version.compareTo(r)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Jh();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(n.localStore,e);Nf(n,i,null),Af(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Mf(n,t)}catch(t){await Bc(t)}}async function kf(t,e,n){const i=mc(t);try{const t=await function(t,e){const n=mc(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let i;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(gc(null!==e),i=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,i))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(i.localStore,e);Nf(i,e,n),Af(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await Mf(i,t)}catch(n){await Bc(n)}}function Af(t,e){(t.uc.get(e)||[]).forEach((t=>{t.resolve()})),t.uc.delete(e)}function Nf(t,e,n){const i=mc(t);let s=i.oc[i.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),i.oc[i.currentUser.toKey()]=s}}function Df(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.ec.get(e))t.tc.delete(i),n&&t.Zu.lc(i,n);t.ec.delete(e),t.isPrimaryClient&&t.rc.us(e).forEach((e=>{t.rc.containsKey(e)||Rf(t,e)}))}function Rf(t,e){t.nc.delete(e.path.canonicalString());const n=t.sc.get(e);null!==n&&(Ld(t.remoteStore,n),t.sc=t.sc.remove(e),t.ic.delete(n),Pf(t))}function Of(t,e,n){for(const i of n)i instanceof gf?(t.rc.addReference(i.key,e),Lf(t,i)):i instanceof mf?(hc("SyncEngine","Document no longer in limbo: "+i.key),t.rc.removeReference(i.key,e),t.rc.containsKey(i.key)||Rf(t,i.key)):pc()}function Lf(t,e){const n=e.key,i=n.path.canonicalString();t.sc.get(n)||t.nc.has(i)||(hc("SyncEngine","New document in limbo: "+n),t.nc.add(i),Pf(t))}function Pf(t){for(;t.nc.size>0&&t.sc.size<t.maxConcurrentLimboResolutions;){const e=t.nc.values().next().value;t.nc.delete(e);const n=new Fc(Pc.fromString(e)),i=t.cc.next();t.ic.set(i,new wf(n)),t.sc=t.sc.insert(n,i),Od(t.remoteStore,new Vl(Yu(Xu(n.path)),i,2,zc.ot))}}async function Mf(t,e,n){const i=mc(t),s=[],r=[],o=[];i.tc.isEmpty()||(i.tc.forEach(((t,a)=>{o.push(i.hc(a,e,n).then((t=>{if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=od.Vi(a.targetId,t);r.push(e)}})))})),await Promise.all(o),i.Zu.Go(s),await async function(t,e){const n=mc(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>qc.forEach(e,(e=>qc.forEach(e.Pi,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>qc.forEach(e.vi,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!$c(t))throw t;hc("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.$i.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.$i=n.$i.insert(e,s)}}}(i.localStore,r))}async function xf(t,e){const n=mc(t);if(!n.currentUser.isEqual(e)){hc("SyncEngine","User change. New user:",e.toKey());const t=await ud(n.localStore,e);n.currentUser=e,function(t,e){t.uc.forEach((t=>{t.forEach((t=>{t.reject(new vc(yc.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.uc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Mf(n,t.Ki)}}function Ff(t,e){const n=mc(t),i=n.ic.get(e);if(i&&i.Xu)return Jh().add(i.key);{let t=Jh();const i=n.ec.get(e);if(!i)return t;for(const e of i){const i=n.tc.get(e);t=t.unionWith(i.view.qu)}return t}}function Uf(t){const e=mc(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Cf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kf.bind(null,e),e}class Vf{constructor(){this.synchronizeTabs=!1}async initialize(t){this.wt=bd(t.databaseInfo.databaseId),this.sharedClientState=this.dc(t),this.persistence=this._c(t),await this.persistence.start(),this.localStore=this.wc(t),this.gcScheduler=this.mc(t,this.localStore),this.indexBackfillerScheduler=this.gc(t,this.localStore)}mc(t,e){return null}gc(t,e){return null}wc(t){return function(t,e,n,i){return new cd(t,e,n,i)}(this.persistence,new ad,t.initialUser,this.wt)}_c(t){return new id(rd.Ms,this.wt)}dc(t){return new gd}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class jf{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>_f(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=xf.bind(null,this.syncEngine),await async function(t,e){const n=mc(t);e?(n.lu.delete(2),await Dd(n)):e||(n.lu.add(2),await Rd(n),n._u.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new hf}createDatastore(t){const e=bd(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new Id(i));var i;return function(t,e,n,i){return new kd(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,s=t=>_f(this.syncEngine,t,0),r=yd.V()?new yd:new md,new Nd(e,n,i,s,r);var e,n,i,s,r}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new If(t,e,n,i,s,r);return o&&(a.ac=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=mc(t);hc("RemoteStore","RemoteStore shutting down."),e.lu.add(5),await Rd(e),e.du.shutdown(),e._u.set("Unknown")}(this.remoteStore)}}class Bf{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ic(this.observer.next,t)}error(t){this.observer.error?this.Ic(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Tc(){this.muted=!0}Ic(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class qf{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=oc.UNAUTHENTICATED,this.clientId=Ac.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{hc("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(hc("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new vc(yc.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new wc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=rf(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function $f(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){return t.offlineComponents||(hc("FirestoreClient","Using default OfflineComponentProvider"),await async function(t,e){t.asyncQueue.verifyOperationInProgress(),hc("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await ud(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}(t,new Vf)),t.offlineComponents}(t);hc("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>tf(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>tf(e.remoteStore,n))),t.onlineComponents=e}async function zf(t){return t.onlineComponents||(hc("FirestoreClient","Using default OnlineComponentProvider"),await $f(t,new jf)),t.onlineComponents}async function Kf(t){const e=await zf(t),n=e.eventManager;return n.onListen=Ef.bind(null,e.syncEngine),n.onUnlisten=bf.bind(null,e.syncEngine),n}function Hf(t,e,n={}){const i=new wc;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,s){const r=new Bf({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=mc(t),i=e.query;let s=!1;const r=n.queries.get(i);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),s=0===r.listeners.length)}if(s)return n.queries.delete(i),n.onUnlisten(i)}(t,o))),n.fromCache&&"server"===i.source?s.reject(new vc(yc.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new pf(n,r,{includeMetadataChanges:!0,Du:!0});return async function(t,e){const n=mc(t),i=e.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new uf),s)try{r.Iu=await n.onListen(i)}catch(t){const n=rf(t,`Initialization of query '${eh(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,r),r.listeners.push(e),e.Eu(n.onlineState),r.Iu&&e.Au(r.Iu)&&ff(n)}(t,o)}(await Kf(t),t.asyncQueue,e,n,i))),i.promise}const Gf=new Map;function Wf(t,e,n){if(!n)throw new vc(yc.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Qf(t){if(!Fc.isDocumentKey(t))throw new vc(yc.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Xf(t){if(Fc.isDocumentKey(t))throw new vc(yc.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Jf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":pc()}function Yf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new vc(yc.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Jf(t);throw new vc(yc.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Zf{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new vc(yc.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new vc(yc.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,i){if(!0===e&&!0===i)throw new vc(yc.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class tp{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Zf({}),this._settingsFrozen=!1,t instanceof uu?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new vc(yc.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uu(t.options.projectId)}(t))}get app(){if(!this._app)throw new vc(yc.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new vc(yc.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Zf(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Ec;switch(t.type){case"gapi":const e=t.client;return gc(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new _c(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new vc(yc.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Gf.get(t);e&&(hc("ComponentProvider","Removing Datastore"),Gf.delete(t),e.terminate())}(this),Promise.resolve()}}class ep{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ip(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ep(this.firestore,t,this._key)}}class np{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new np(this.firestore,t,this._query)}}class ip extends np{constructor(t,e,n){super(t,e,Xu(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ep(this.firestore,null,new Fc(t))}withConverter(t){return new ip(this.firestore,t,this._path)}}function sp(t,e,...n){if(t=T(t),Wf("collection","path",e),t instanceof tp){const i=Pc.fromString(e,...n);return Xf(i),new ip(t,null,i)}{if(!(t instanceof ep||t instanceof ip))throw new vc(yc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(Pc.fromString(e,...n));return Xf(i),new ip(t.firestore,null,i)}}class rp{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Td(this,"async_queue_retry"),this.Kc=()=>{const t=Ed();t&&hc("AsyncQueue","Visibility state changed to "+t.visibilityState),this.So.Eo()};const t=Ed();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Gc(),this.Qc(t)}enterRestrictedMode(t){if(!this.Fc){this.Fc=!0,this.Uc=t||!1;const e=Ed();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Kc)}}enqueue(t){if(this.Gc(),this.Fc)return new Promise((()=>{}));const e=new wc;return this.Qc((()=>this.Fc&&this.Uc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Mc.push(t),this.jc())))}async jc(){if(0!==this.Mc.length){try{await this.Mc[0](),this.Mc.shift(),this.So.reset()}catch(t){if(!$c(t))throw t;hc("AsyncQueue","Operation failed with retryable error: "+t)}this.Mc.length>0&&this.So.Io((()=>this.jc()))}}Qc(t){const e=this.Oc.then((()=>(this.Lc=!0,t().catch((t=>{this.Bc=t,this.Lc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw lc("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Lc=!1,t))))));return this.Oc=e,e}enqueueAfterDelay(t,e,n){this.Gc(),this.qc.indexOf(t)>-1&&(e=0);const i=sf.createAndSchedule(this,t,e,n,(t=>this.Wc(t)));return this.$c.push(i),i}Gc(){this.Bc&&pc()}verifyOperationInProgress(){}async zc(){let t;do{t=this.Oc,await t}while(t!==this.Oc)}Hc(t){for(const e of this.$c)if(e.timerId===t)return!0;return!1}Jc(t){return this.zc().then((()=>{this.$c.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.$c)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.zc()}))}Yc(t){this.qc.push(t)}Wc(t){const e=this.$c.indexOf(t);this.$c.splice(e,1)}}class op extends tp{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new rp,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||cp(this),this._firestoreClient.terminate()}}function ap(t){return t._firestoreClient||cp(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function cp(t){var e;const n=t._freezeSettings(),i=function(t,e,n,i){return new cu(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new qf(t._authCredentials,t._appCheckCredentials,t._queue,i)}class up{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new vc(yc.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xc(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class hp{constructor(t){this._byteString=t}static fromBase64String(t){try{return new hp(tu.fromBase64String(t))}catch(t){throw new vc(yc.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new hp(tu.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class lp{constructor(t){this._methodName=t}}class dp{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new vc(yc.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new vc(yc.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Nc(this._lat,t._lat)||Nc(this._long,t._long)}}const fp=/^__.*__$/;class pp{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Dh(t,this.data,this.fieldMask,e,this.fieldTransforms):new Nh(t,this.data,e,this.fieldTransforms)}}function gp(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw pc()}}class mp{constructor(t,e,n,i,s,r){this.settings=t,this.databaseId=e,this.wt=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Xc(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(t){return new mp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.ta({path:n,na:!1});return i.sa(t),i}ia(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.ta({path:n,na:!1});return i.Xc(),i}ra(t){return this.ta({path:void 0,na:!0})}oa(t){return kp(t,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Xc(){if(this.path)for(let t=0;t<this.path.length;t++)this.sa(this.path.get(t))}sa(t){if(0===t.length)throw this.oa("Document fields must not be empty");if(gp(this.Zc)&&fp.test(t))throw this.oa('Document fields cannot begin and end with "__"')}}class yp{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.wt=n||bd(t)}aa(t,e,n,i=!1){return new mp({Zc:t,methodName:e,ca:n,path:xc.emptyPath(),na:!1,ua:i},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function vp(t){const e=t._freezeSettings(),n=bd(t._databaseId);return new yp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function wp(t,e,n,i,s,r={}){const o=t.aa(r.merge||r.mergeFields?2:0,e,n,s);Tp("Data must be an object, but it was:",o,i);const a=Ep(i,o);let c,u;if(r.merge)c=new Zc(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const i of r.mergeFields){const s=_p(e,i,n);if(!o.contains(s))throw new vc(yc.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Ap(t,s)||t.push(s)}c=new Zc(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new pp(new ku(a),c,u)}function Ip(t,e){if(bp(t=T(t)))return Tp("Unsupported field value:",e,t),Ep(t,e);if(t instanceof lp)return function(t,e){if(!gp(e.Zc))throw e.oa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.oa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.na&&4!==e.Zc)throw e.oa("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const s of t){let t=Ip(s,e.ra(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=T(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ah(e.wt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Rc.fromDate(t);return{timestampValue:dl(e.wt,n)}}if(t instanceof Rc){const n=new Rc(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:dl(e.wt,n)}}if(t instanceof dp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof hp)return{bytesValue:fl(e.wt,t._byteString)};if(t instanceof ep){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.oa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ml(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.oa(`Unsupported field value: ${Jf(t)}`)}(t,e)}function Ep(t,e){const n={};return Gc(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hc(t,((t,i)=>{const s=Ip(i,e.ea(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function bp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Rc||t instanceof dp||t instanceof hp||t instanceof ep||t instanceof lp)}function Tp(t,e,n){if(!bp(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=Jf(n);throw"an object"===i?e.oa(t+" a custom object"):e.oa(t+" "+i)}}function _p(t,e,n){if((e=T(e))instanceof up)return e._internalPath;if("string"==typeof e)return Cp(t,e);throw kp("Field path arguments must be of type string or ",t,!1,void 0,n)}const Sp=new RegExp("[~\\*/\\[\\]]");function Cp(t,e,n){if(e.search(Sp)>=0)throw kp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new up(...e.split("."))._internalPath}catch(i){throw kp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function kp(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new vc(yc.INVALID_ARGUMENT,a+t+c)}function Ap(t,e){return t.some((t=>t.isEqual(e)))}class Np{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ep(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Dp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Rp("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Dp extends Np{data(){return super.data()}}function Rp(t,e){return"string"==typeof e?Cp(t,e):e instanceof up?e._internalPath:e._delegate._internalPath}class Op{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Lp extends Np{constructor(t,e,n,i,s,r){super(t,e,n,i,r),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Pp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Rp("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Pp extends Lp{data(t={}){return super.data(t)}}class Mp{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Op(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Pp(this._firestore,this._userDataWriter,n.key,n,new Op(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new vc(yc.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Pp(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Op(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new Pp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Op(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,r=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:xp(e.type),doc:i,oldIndex:s,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function xp(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return pc()}}class Fp extends class{convertValue(t,e="none"){switch(fu(t)){case 0:return null;case 1:return t.booleanValue;case 2:return iu(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(su(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw pc()}}convertObject(t,e){const n={};return Hc(t.fields,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new dp(iu(t.latitude),iu(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ou(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(au(t));default:return null}}convertTimestamp(t){const e=nu(t);return new Rc(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Pc.fromString(t);gc(Ml(n));const i=new uu(n.get(1),n.get(3)),s=new Fc(n.popFirst(5));return i.isEqual(e)||lc(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new hp(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ep(this.firestore,null,e)}}function Up(t,e){const n=Yf(t.firestore,op),i=function(t,e,...n){if(t=T(t),1===arguments.length&&(e=Ac.I()),Wf("doc","path",e),t instanceof tp){const i=Pc.fromString(e,...n);return Qf(i),new ep(t,null,new Fc(i))}{if(!(t instanceof ep||t instanceof ip))throw new vc(yc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(Pc.fromString(e,...n));return Qf(i),new ep(t.firestore,t instanceof ip?t.converter:null,new Fc(i))}}(t),s=function(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}(t.converter,e);return function(t,e){return function(t,e){const n=new wc;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const i=Uf(t);try{const t=await function(t,e){const n=mc(t),i=Rc.now(),s=e.reduce(((t,e)=>t.add(e.key)),Jh());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=qh(),c=Jh();return n.Ui.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{r=s;const o=[];for(const t of e){const e=kh(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new Dh(t.key,e,Au(e.value.mapValue),Eh.exists(!0)))}return n.mutationQueue.addMutationBatch(t,i,o,e)})).next((e=>{o=e;const i=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:Kh(r)})))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.oc[t.currentUser.toKey()];i||(i=new Wc(Nc)),i=i.insert(e,n),t.oc[t.currentUser.toKey()]=i}(i,t.batchId,n),await Mf(i,t.changes),await Kd(i.remoteStore)}catch(t){const e=rf(t,"Failed to persist write");n.reject(e)}}(await function(t){return zf(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(ap(t),e)}(n,[wp(vp(t.firestore),"addDoc",i._key,s,null!==t.converter,{}).toMutation(i._key,Eh.exists(!1))]).then((()=>i))}!function(t,e=!0){ac="9.8.4",at(new _("firestore",((t,{options:n})=>{const i=t.getProvider("app").getImmediate(),s=new op(i,new bc(t.getProvider("auth-internal")),new Cc(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s}),"PUBLIC")),ft(rc,"3.4.11",t),ft(rc,"3.4.11","esm2017")}();const Vp=function(t,e={}){"object"!=typeof e&&(e={name:e});const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},e),i=n.name;if("string"!=typeof i||!i)throw ut.create("bad-app-name",{appName:String(i)});const s=st.get(i);if(s){if(g(t,s.options)&&g(n,s.config))return s;throw ut.create("duplicate-app",{appName:i})}const r=new k(i);for(const t of rt.values())r.addComponent(t);const o=new ht(t,n,r);return st.set(i,o),o}({apiKey:"AIzaSyDKTHyrzjrAL2hQshKiIELpKPD92evALnA",authDomain:"rentals-manager-1e88f.firebaseapp.com",projectId:"rentals-manager-1e88f",storageBucket:"rentals-manager-1e88f.appspot.com",messagingSenderId:"516133871814",appId:"1:516133871814:web:5ef259c651d6dfa54737c7",measurementId:"G-92CRB0J8Z3"}),jp=function(t=dt()){return ct(t,"firestore").getImmediate()}(Vp),Bp=function(t=dt()){const e=ct(t=T(t),ki);return e.isInitialized()?e.getImmediate():function(t,e={}){const n=ct(t,ki);if(n.isInitialized()){const t=n.getImmediate();if(g(e,n.getOptions()))return t;throw Ri.create("already-initialized")}return n.initialize({options:e})}(t)}(Vp);console.log(Bp);const qp=function(){var t;(t=function(t=dt()){const e=ct(t,"auth");return e.isInitialized()?e.getImmediate():function(t,e){const n=ct(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(g(n.getOptions(),null!=e?e:{}))return t;At(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:qn,persistence:[hn,He,We]})}(),T(t).signOut()).then((()=>{console.log("user signed out"),window.location.replace("index.html")})).catch((t=>{console.log(t)}))},$p=async()=>{const t=await function(t){t=Yf(t,np);const e=Yf(t.firestore,op),n=ap(e),i=new Fp(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new vc(yc.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Hf(n,t._query).then((n=>new Mp(e,i,t,n)))}(sp(jp,"properties"));t.forEach((t=>{console.log(`${t.id} => ${JSON.stringify(t.data())}`),JSON.stringify(t.data()),console.log(JSON.stringify(t.data().name)),((t,e,n,i,s,r)=>{if("content"in document.createElement("template")){var o=document.getElementById("property_table"),a=document.getElementById("property_item").content.cloneNode(!0);console.log("clone table"),a.getElementById("Property_name").textContent=t,console.log("get name"),a.getElementById("Property_type").textContent=e,console.log("get type"),a.getElementById("Property_unit").textContent=n,console.log("get units"),a.getElementById("Property_owner").textContent=i,console.log("get owner"),a.getElementById("Property_operating_account").textContent=s,console.log("get account"),a.getElementById("Property_address").textContent=r,console.log("get apartment"),o.appendChild(a)}})(JSON.stringify(t.data().name),JSON.stringify(t.data().type),JSON.stringify(t.data().units),JSON.stringify(t.data().owner),JSON.stringify(t.data().operating_account),JSON.stringify(t.data().address))}))},zp=()=>{document.getElementById("add_new_property_form").style.display="block",document.getElementById("submit_item_button").addEventListener("click",(t=>{Kp(),t.preventDefault()}))},Kp=()=>{var t=document.getElementById("property_name_input").value,e=document.getElementById("property_type_input").value,n=document.getElementById("property_units_input").value,i=document.getElementById("property_owner_input").value,s=document.getElementById("property_operating_account_input").value,r=document.getElementById("property_address_input").value;console.log(t,e,n,i,s,r),async function(t,e,n,i,s,r){try{const o=await Up(sp(jp,"properties"),{name:t,type:e,units:n,owner:i,operating_account:s,address:r});console.log("Document written with ID: ",o.id),window.location.reload()}catch(t){console.error("Error adding document: ",t)}}(t,e,n,i,s,r),document.getElementById("add_new_property_form").style.display="none"};document.addEventListener("DOMContentLoaded",(function(){console.log("loaded"),document.getElementById("signout_button").addEventListener("click",qp),console.log("event: sign out"),document.getElementById("add_property").addEventListener("click",zp),console.log("event: add property"),$p()}),!1)})();